# Tasks_25AUG2025#Saisyuu1.md - Êé°ÈõÜÊ©üËÉΩÊßãÁØâÂàÜÊûê„É¨„Éù„Éº„Éà

**‰ΩúÊàêÊó•**: 2025Âπ¥8Êúà25Êó•  
**ÂàÜÊûêËÄÖ**: GitHub Copilot  
**ÂØæË±°**: Êé°ÈõÜÈñ¢ÈÄ£Ê©üËÉΩ„ÅÆÂÜçÊßãÁØâË®àÁîª  

---

## üîç ÁèæÁä∂ÂàÜÊûêÁµêÊûú

### üìä ÁèæÂú®„ÅÆÊé°ÈõÜ„Ç∑„Çπ„ÉÜ„É†ÂÆüË£ÖÁä∂Ê≥Å

#### 1. **„Éá„Éº„ÇøÁÆ°ÁêÜ**: „Éè„Éº„Éâ„Ç≥„Éº„ÉâÊñπÂºè
- **„Éï„Ç°„Ç§„É´**: `app/Models/GatheringTable.php`
- **ÊñπÂºè**: ÈÖçÂàó„Éô„Éº„Çπ„ÅÆÈùôÁöÑ„Éá„Éº„ÇøÁÆ°ÁêÜ
- **ÂïèÈ°åÁÇπ**: 
  - ÁÆ°ÁêÜÁîªÈù¢„Åã„Çâ„ÅÆÁ∑®ÈõÜ‰∏çÂèØ
  - „Çπ„Ç±„Éº„É©„Éì„É™„ÉÜ„Ç£„ÅÆ‰∏çË∂≥
  - „Éê„É™„Ç®„Éº„Ç∑„Éß„É≥ËøΩÂä†„ÅÆÂõ∞Èõ£

#### 2. **Êé°ÈõÜ„É≠„Ç∏„ÉÉ„ÇØ**: ÂÆüË£ÖÊ∏à„Åø
- **„Ç≥„É≥„Éà„É≠„Éº„É©„Éº**: `app/Http/Controllers/GatheringController.php`
- **APIÂÆüË£Ö**: ‚úÖ ÂÆå‰∫Ü
  - `POST /gathering/gather` - Êé°ÈõÜÂÆüË°å
  - `GET /gathering/info` - Êé°ÈõÜÊÉÖÂ†±ÂèñÂæó
- **„Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ**: ‚úÖ Âãï‰Ωú‰∏≠
  - SP„Ç≥„Çπ„ÉàË®àÁÆó
  - „Çπ„Ç≠„É´„É¨„Éô„É´Âà∂Èôê
  - ÊàêÂäüÁéá„ÉªÊï∞ÈáèË®àÁÆó

#### 3. **UIÂÆüË£Ö**: „Éû„É´„ÉÅ„É¨„Ç§„Ç¢„Ç¶„ÉàÂØæÂøú
- **ÂÆüË£Ö„Éï„Ç°„Ç§„É´**:
  - `resources/views/game/partials/location_info.blade.php`
  - `resources/views/game-states/road-*.blade.php`
- **Ê©üËÉΩ**: 
  - Êé°ÈõÜ„Éú„Çø„É≥„ÉªÊÉÖÂ†±„Éú„Çø„É≥Ë°®Á§∫
  - „Çπ„Ç≠„É´„É¨„Éô„É´Ë°®Á§∫
  - Ê®©Èôê„Éô„Éº„ÇπË°®Á§∫Âà∂Âæ°

#### 4. **„Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†**: Routes‰∏≠ÂøÉË®≠Ë®à
- **„É°„Ç§„É≥„ÉÜ„Éº„Éñ„É´**: `routes` (Êóßgame_locations)
- **„Ç´„ÉÜ„Ç¥„É™**: `road`, `town`, `dungeon`
- **Êé°ÈõÜÂØæË±°**: `road`„Ç´„ÉÜ„Ç¥„É™„ÅÆ„ÅøÂÆüË£ÖÔºà**Êã°ÂºµË¶ÅÊ±Ç**: `dungeon`„Ç´„ÉÜ„Ç¥„É™„ÇÇÂØæÂøúÔºâ

---

## üéØ Ë¶Å‰ª∂ÂàÜÊûê

### ‚úÖ Ê∫Ä„Åü„Åô„Åπ„ÅçË¶Å‰ª∂
1. **ÁÆ°ÁêÜ„ÅÆ„Åó„ÇÑ„Åô„ÅÑÊé°ÈõÜÁÆ°ÁêÜÊ©üËÉΩ„ÇíAdminÁÆ°ÁêÜÁîªÈù¢„Å´ÂÆüË£Ö**
2. **ÂêÑ„Éû„ÉÉ„Éó(Routes)„Å®„ÅÆ1ÂØæ1Êé•Á∂ö**
3. **ÁèæÂú®„ÅÆ„Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØÁ∂≠ÊåÅ**
4. **„É¨„Éï„Ç°„É¨„É≥„Çπ„Éâ„Ç≠„É•„É°„É≥„ÉàÊ∫ñÊã†„ÅÆÂÆüË£Ö**
5. **üÜï Road„ÉªDungeon‰∏°Êñπ„Åß„ÅÆÊé°ÈõÜÂØæÂøú** (Êñ∞Ë¶Å‰ª∂)

### üîß ÊäÄË°ìË¶Å‰ª∂
- **Laravel 11** MVC „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£
- **AdminControllerÂü∫Â∫ï„ÇØ„É©„Çπ** Á∂ôÊâø
- **Ê®©Èôê„Éô„Éº„Çπ„Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°** (RBAC)
- **Áõ£Êüª„É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†** Áµ±Âêà
- **Áµ±‰∏Ä„Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†** ÈÅ©Áî®
- **üÜï Road„ÉªDungeon‰∏°ÂØæÂøúÊé°ÈõÜ„Ç∑„Çπ„ÉÜ„É†** (Êã°ÂºµË¶Å‰ª∂)

---

## ÔøΩ Road„ÉªDungeon‰∏°ÂØæÂøúÊé°ÈõÜ„Ç∑„Çπ„ÉÜ„É†Êã°ÂºµÂàÜÊûê

### üìä ÁèæÂú®„ÅÆ„ÉÄ„É≥„Ç∏„Éß„É≥ÂÆüË£ÖÁä∂Ê≥Å

#### 1. **„ÉÄ„É≥„Ç∏„Éß„É≥„Éá„Éº„ÇøÊßãÈÄ†**: ÈöéÂ±§ÂåñË®≠Ë®à
- **„ÉÄ„É≥„Ç∏„Éß„É≥ÂÆöÁæ©**: `dungeons_desc` „ÉÜ„Éº„Éñ„É´
- **„Éï„É≠„Ç¢ÁÆ°ÁêÜ**: `routes` „ÉÜ„Éº„Éñ„É´Ôºà`category='dungeon'`, `dungeon_id`„ÅßÁ¥ê‰ªò„ÅëÔºâ
- **Êó¢Â≠ò„ÉÄ„É≥„Ç∏„Éß„É≥**:
  - `dungeon_1`: Âè§„ÅÆÊ¥ûÁ™üÔºà1F, Lv3-10Ôºâ
  - `dungeon_2`: Âøò„Çå„Çâ„Çå„ÅüÈÅ∫Ë∑°Ôºà1F, Lv8-20Ôºâ
  - `dungeon_secret_room`: Èö†„ÅóÈÉ®Â±ãÔºà1F, Lv1-5Ôºâ
  - `test_pyramid_1f`: „ÉÜ„Çπ„Éà„Éî„É©„Éü„ÉÉ„Éâ1Èöé

#### 2. **„ÉÄ„É≥„Ç∏„Éß„É≥ÁâπÊÄß„Å®Êé°ÈõÜ„ÅÆÈñ¢ÈÄ£ÊÄß**
- **Áí∞Â¢ÉÂ∑ÆÁï∞**: Ê¥ûÁ™ü„ÉªÈÅ∫Ë∑°„ÉªÂú∞‰∏ãÁ©∫Èñì„ÅØÈÅìË∑Ø„Å®Áï∞„Å™„ÇãÊé°ÈõÜÁí∞Â¢É
- **„É¨„Ç¢„É™„ÉÜ„Ç£**: „ÉÄ„É≥„Ç∏„Éß„É≥„ÅØ‰∏ÄËà¨ÁöÑ„Å´„Çà„ÇäÂ∏åÂ∞ë„Å™„Ç¢„Ç§„ÉÜ„É†„ÅåÊé°ÈõÜÂèØËÉΩ
- **Âç±Èô∫Â∫¶**: `min_level`/`max_level`„Å´Âü∫„Å•„ÅèÊé°ÈõÜÈõ£ÊòìÂ∫¶
- **„Éï„É≠„Ç¢Âà•Â∑ÆÁï∞**: Ê∑±„ÅÑ„Éï„É≠„Ç¢„Åª„Å©È´òÂìÅË≥™„Å™„Ç¢„Ç§„ÉÜ„É†

#### 3. **UIÂÆüË£ÖÁèæÁä∂**: ÈÅìË∑ØÂ∞ÇÁî®
- **Âà∂Èôê**: ÁèæÂú®„ÅÆÊé°ÈõÜ„Éú„Çø„É≥„ÅØ„ÄåÈÅì„Åß„ÅÆË°åÂãï„Äç„Çª„ÇØ„Ç∑„Éß„É≥„Å´„ÅÆ„ÅøË°®Á§∫
- **Ë°®Á§∫Êù°‰ª∂**: `$currentLocation['category'] === 'road'` „Åß„ÅÆ„ÅøÊé°ÈõÜUIË°®Á§∫
- **„É©„Éô„É™„É≥„Ç∞**: "ÈÅì„Åß„ÅÆË°åÂãï" „Éè„Éº„Éâ„Ç≥„Éº„Éâ

#### 4. **„Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØÂà∂Èôê**: Road Only
- **Êé°ÈõÜÂÆüË°å**: `$player->location_type !== 'road'` „Åß„Ç®„É©„Éº
- **Êé°ÈõÜÊÉÖÂ†±**: ÂêåÊßò„Å´roadÈôêÂÆö„ÉÅ„Çß„ÉÉ„ÇØ

### üéØ Road„ÉªDungeon‰∏°ÂØæÂøúË®≠Ë®à

#### A. **Êé°ÈõÜÁí∞Â¢ÉÂàÜÈ°û„Ç∑„Çπ„ÉÜ„É†**
```php
// Êé°ÈõÜÁí∞Â¢É„Çø„Ç§„ÉóÂÆöÁæ©Ôºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
enum GatheringEnvironment: string 
{
    case ROAD = 'road';           // ÈÅìË∑ØÁí∞Â¢É
    case DUNGEON = 'dungeon';     // „ÉÄ„É≥„Ç∏„Éß„É≥Áí∞Â¢É
    
    public function getDisplayName(): string
    {
        return match($this) {
            self::ROAD => 'ÈÅìË∑Ø',
            self::DUNGEON => '„ÉÄ„É≥„Ç∏„Éß„É≥',
        };
    }
}
```

#### B. **Êã°ÂºµGatheringMapping„ÉÜ„Éº„Éñ„É´Ë®≠Ë®à**
```sql
CREATE TABLE gathering_mappings (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    route_id VARCHAR(255) NOT NULL,
    item_id BIGINT UNSIGNED NOT NULL,
    
    -- Âü∫Êú¨Êé°ÈõÜË®≠ÂÆö
    required_skill_level INT NOT NULL DEFAULT 1,
    success_rate INT NOT NULL,
    quantity_min INT NOT NULL DEFAULT 1,
    quantity_max INT NOT NULL DEFAULT 1,
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    INDEX idx_route_id (route_id),
    INDEX idx_item_id (item_id),
    INDEX idx_skill_level (required_skill_level),
    INDEX idx_active (is_active),
    
    FOREIGN KEY (route_id) REFERENCES routes(id) ON DELETE CASCADE,
    FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,
    
    UNIQUE KEY unique_route_item (route_id, item_id)
);
```

#### C. **Route „É¢„Éá„É´Êã°Âºµ**
```php
// app/Models/Route.php „Å´ËøΩÂä†

/**
 * Êé°ÈõÜÂèØËÉΩÂà§ÂÆöÔºàRoad„ÉªDungeonÂØæÂøúÔºâ
 */
public function hasGatheringItems(): bool
{
    return in_array($this->category, ['road', 'dungeon']) 
           && $this->gatheringMappings()->exists();
}
```

---

## ÔøΩüèóÔ∏è Êé®Â•®„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£Ë®≠Ë®à

### 1. **„Éá„Éº„Çø„Éô„Éº„ÇπË®≠Ë®à**: Êã°ÂºµÊÄßÈáçË¶ñ

#### A. **GatheringMapping „ÉÜ„Éº„Éñ„É´** (Êñ∞Ë¶è‰ΩúÊàê)
```sql
CREATE TABLE gathering_mappings (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    route_id VARCHAR(255) NOT NULL,
    item_id BIGINT UNSIGNED NOT NULL,
    required_skill_level INT NOT NULL DEFAULT 1,
    success_rate INT NOT NULL,        -- 1-100
    quantity_min INT NOT NULL DEFAULT 1,
    quantity_max INT NOT NULL DEFAULT 1,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    INDEX idx_route_id (route_id),
    INDEX idx_item_id (item_id),
    INDEX idx_skill_level (required_skill_level),
    INDEX idx_active (is_active),
    
    FOREIGN KEY (route_id) REFERENCES routes(id) ON DELETE CASCADE,
    FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,
    
    UNIQUE KEY unique_route_item (route_id, item_id)
);
```

#### B. **GatheringCategory „ÉÜ„Éº„Éñ„É´** (Â∞ÜÊù•Êã°ÂºµÁî®)
```sql
CREATE TABLE gathering_categories (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    icon_class VARCHAR(50),
    sort_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL
);
```

### 2. **„É¢„Éá„É´„Éª„É™„É¨„Éº„Ç∑„Éß„É≥Ë®≠Ë®à**

#### A. **GatheringMapping „É¢„Éá„É´**
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class GatheringMapping extends Model
{
    protected $fillable = [
        'route_id',
        'item_id', 
        'required_skill_level',
        'success_rate',
        'quantity_min',
        'quantity_max',
        'is_active',
    ];

    protected $casts = [
        'required_skill_level' => 'integer',
        'success_rate' => 'integer',
        'quantity_min' => 'integer',
        'quantity_max' => 'integer',
        'is_active' => 'boolean',
    ];

    // „É™„É¨„Éº„Ç∑„Éß„É≥
    public function route(): BelongsTo
    {
        return $this->belongsTo(Route::class, 'route_id', 'id');
    }

    public function item(): BelongsTo
    {
        return $this->belongsTo(Item::class);
    }

    // „Çπ„Ç≥„Éº„Éó
    public function scopeActive($query)
    {
        return $query->where('is_active', true);
    }

    public function scopeForSkillLevel($query, int $skillLevel)
    {
        return $query->where('required_skill_level', '<=', $skillLevel);
    }

    // Ê•≠Âãô„É≠„Ç∏„ÉÉ„ÇØ
    public function calculateSuccessRate(int $playerSkillLevel): int
    {
        $baseRate = $this->success_rate;
        $skillBonus = max(0, ($playerSkillLevel - $this->required_skill_level) * 5);
        $finalRate = $baseRate + $skillBonus;
        
        return min(100, (int)$finalRate);
    }

    /**
     * üÜï „ÉÄ„É≥„Ç∏„Éß„É≥Êé°ÈõÜÂèØËÉΩÂà§ÂÆöÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
     */
    public function canGatherInDungeon(int $playerLevel): bool
    {
        // „Éó„É¨„Ç§„É§„Éº„É¨„Éô„É´Ë¶Å‰ª∂Ôºà„ÉÄ„É≥„Ç∏„Éß„É≥„ÅÆÊé®Â•®„É¨„Éô„É´„Å®„Éû„ÉÉ„ÉÅ„É≥„Ç∞Ôºâ
        $route = $this->route;
        if ($route && $route->min_level && $playerLevel < $route->min_level) {
            return false;
        }
        
        return true;
    }
}
```

#### B. **Route „É¢„Éá„É´Êã°Âºµ**
```php
// app/Models/Route.php „Å´ËøΩÂä†

/**
 * Êé°ÈõÜ„Éû„ÉÉ„Éî„É≥„Ç∞
 */
public function gatheringMappings()
{
    return $this->hasMany(GatheringMapping::class, 'route_id', 'id')
                ->where('is_active', true)
                ->orderBy('required_skill_level')
                ->orderBy('success_rate', 'desc');
}

/**
 * „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™Êé°ÈõÜ„Ç¢„Ç§„ÉÜ„É†
 */
public function gatheringItems()
{
    return $this->belongsToMany(Item::class, 'gathering_mappings', 'route_id', 'item_id')
                ->withPivot([
                    'required_skill_level',
                    'success_rate', 
                    'quantity_min',
                    'quantity_max'
                ])
                ->wherePivot('is_active', true);
}

/**
 * Êé°ÈõÜÂèØËÉΩÂà§ÂÆöÔºàRoad„ÉªDungeonÂØæÂøúÔºâ
 */
public function hasGatheringItems(): bool
{
    return in_array($this->category, ['road', 'dungeon']) 
           && $this->gatheringMappings()->exists();
}
```

### 3. **„Çµ„Éº„Éì„Çπ„ÇØ„É©„ÇπË®≠Ë®à**

#### A. **AdminGatheringService**
```php
<?php

namespace App\Services\Admin;

use App\Models\GatheringMapping;
use App\Models\Route;
use App\Models\Item;
use Illuminate\Support\Collection;
use Illuminate\Support\Facades\Log;

class AdminGatheringService
{
    /**
     * üÜï Áí∞Â¢ÉÂà•Êé°ÈõÜ„Éû„ÉÉ„Éî„É≥„Ç∞‰∏ÄË¶ßÂèñÂæó
     */
    public function getGatheringMappingsByEnvironment(array $filters = []): Collection
    {
        $query = GatheringMapping::with(['route', 'item']);
        
        if (!empty($filters['route_id'])) {
            $query->where('route_id', $filters['route_id']);
        }
        
        if (!empty($filters['gathering_environment'])) {
            $query->where('gathering_environment', $filters['gathering_environment']);
        }
        
        if (!empty($filters['item_category'])) {
            $query->whereHas('item', function($q) use ($filters) {
                $q->where('category', $filters['item_category']);
            });
        }
        
        if (isset($filters['skill_level'])) {
            $query->where('required_skill_level', '<=', $filters['skill_level']);
        }
        
        if (isset($filters['is_active'])) {
            $query->where('is_active', $filters['is_active']);
        }
        
        return $query->orderBy('gathering_environment')
                    ->orderBy('required_skill_level')
                    ->get();
    }
    public function getGatheringMappings(array $filters = []): Collection
    {
        // üÜï Áí∞Â¢ÉÂà•„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÂØæÂøúÁâà„Çí‰ΩøÁî®
        return $this->getGatheringMappingsByEnvironment($filters);
    }

    /**
     * üÜï Áí∞Â¢ÉÂà•Êé°ÈõÜÁµ±Ë®à
     */
    public function getGatheringStatsByEnvironment(): array
    {
        return Route::whereIn('category', ['road', 'dungeon'])
            ->withCount(['gatheringMappings as total_items'])
            ->withCount(['gatheringMappings as active_items' => function($q) {
                $q->where('is_active', true);
            }])
            ->get()
            ->groupBy('category')
            ->map(function($routes, $category) {
                return [
                    'category' => $category,
                    'category_name' => $category === 'road' ? 'ÈÅìË∑Ø' : '„ÉÄ„É≥„Ç∏„Éß„É≥',
                    'total_routes' => $routes->count(),
                    'routes_with_gathering' => $routes->where('total_items', '>', 0)->count(),
                    'total_gathering_items' => $routes->sum('total_items'),
                    'active_gathering_items' => $routes->sum('active_items'),
                    'routes' => $routes->map(function($route) {
                        return [
                            'route_id' => $route->id,
                            'route_name' => $route->name,
                            'environment' => $route->gathering_environment ?? 'road',
                            'total_items' => $route->total_items,
                            'active_items' => $route->active_items,
                            'completion_rate' => $route->total_items > 0 
                                ? round(($route->active_items / $route->total_items) * 100, 1)
                                : 0,
                        ];
                    })->toArray(),
                ];
            })
            ->values()
            ->toArray();
    }

    /**
     * „É´„Éº„ÉàÂà•Êé°ÈõÜÁµ±Ë®à
     */
    public function getGatheringStatsByRoute(): array
    {
        // üÜï Áí∞Â¢ÉÂà•Áµ±Ë®à„ÇíÂ±ïÈñã„Åó„Å¶„É´„Éº„ÉàÂà•„Å´Â§âÊèõ
        $environmentStats = $this->getGatheringStatsByEnvironment();
        
        $routes = [];
        foreach ($environmentStats as $envStat) {
            $routes = array_merge($routes, $envStat['routes']);
        }
        
        return $routes;
    }

    /**
     * „Éê„É´„ÇØ„Ç§„É≥„Éù„Éº„ÉàÔºàÊó¢Â≠ò„Éá„Éº„ÇøÁßªË°åÁî®Ôºâ
     */
    public function bulkImportFromGatheringTable(): array
    {
        $importedCount = 0;
        $errors = [];
        
        try {
            $gatheringData = \App\Models\GatheringTable::getGatheringTableByRoad('road_1');
            // ÂÆüË£Ö: Êó¢Â≠ò„Éá„Éº„Çø„ÅÆ‰∏ÄÊã¨Â§âÊèõÂá¶ÁêÜ
            
        } catch (\Exception $e) {
            Log::error('Gathering bulk import failed', ['error' => $e->getMessage()]);
            $errors[] = $e->getMessage();
        }
        
        return [
            'imported_count' => $importedCount,
            'errors' => $errors,
        ];
    }

    /**
     * Êé°ÈõÜ„Éá„Éº„Çø„ÅÆÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØÔºàRoad/DungeonÂØæÂøúÔºâ
     */
    public function validateGatheringData(array $data): array
    {
        $errors = [];
        
        // „É´„Éº„ÉàÂ≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ
        $route = Route::find($data['route_id']);
        if (!$route) {
            $errors[] = '„É´„Éº„Éà„ÅåÂ≠òÂú®„Åó„Åæ„Åõ„Çì';
            return $errors;
        }
        
        // Road„ÅãDungeon„ÅÆ„ÅøÊé°ÈõÜÂèØËÉΩ
        if (!in_array($route->category, ['road', 'dungeon'])) {
            $errors[] = 'Êé°ÈõÜ„ÅØRoad„Åæ„Åü„ÅØDungeon„Åß„ÅÆ„ÅøÂèØËÉΩ„Åß„Åô';
            return $errors;
        }
        
        // Áí∞Â¢É„Å®„É´„Éº„Éà„Ç´„ÉÜ„Ç¥„É™„ÅÆÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        if (!$this->isValidEnvironmentForRoute($data['gathering_environment'] ?? 'road', $route->category)) {
            $errors[] = 'ÈÅ∏Êäû„Åï„Çå„ÅüÁí∞Â¢É„ÅØ„Åì„ÅÆ„É´„Éº„Éà„Çø„Ç§„Éó„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì';
        }
        
        // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
        if ($this->isDuplicateGathering($data['route_id'], $data['item_id'], $data['gathering_environment'] ?? 'road')) {
            $errors[] = '„Åì„ÅÆ„É´„Éº„Éà„Éª„Ç¢„Ç§„ÉÜ„É†„ÉªÁí∞Â¢É„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô';
        }
        
        return $errors;
    }

    /**
     * Áí∞Â¢É„Å®„É´„Éº„Éà„Ç´„ÉÜ„Ç¥„É™„ÅÆÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
     */
    private function isValidEnvironmentForRoute(string $environment, string $routeCategory): bool
    {
        // Road: roadÁí∞Â¢É„ÅÆ„Åø
        if ($routeCategory === 'road') {
            return $environment === 'road';
        }
        
        // Dungeon: dungeonÁí∞Â¢É„ÅÆ„Åø
        if ($routeCategory === 'dungeon') {
            return $environment === 'dungeon';
        }
        
        // „Åù„ÅÆ‰ªñÔºàtownÁ≠âÔºâ„ÅØÊé°ÈõÜ‰∏çÂèØ
        return false;
    }

    /**
     * ÈáçË§áÊé°ÈõÜË®≠ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ
     */
    private function isDuplicateGathering(string $routeId, int $itemId, string $environment): bool
    {
        return GatheringMapping::where('route_id', $routeId)
            ->where('item_id', $itemId)
            ->where('gathering_environment', $environment)
            ->exists();
    }
}
```

### 4. **ÁÆ°ÁêÜÁîªÈù¢„Ç≥„É≥„Éà„É≠„Éº„É©„ÉºË®≠Ë®à**

#### A. **AdminGatheringController** (Êñ∞Ë¶è‰ΩúÊàê)
```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Admin\AdminController;
use App\Models\GatheringMapping;
use App\Models\Route;
use App\Models\Item;
use App\Services\Admin\AdminGatheringService;
use App\Services\Admin\AdminAuditService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Validation\Rule;

class AdminGatheringController extends AdminController
{
    private AdminGatheringService $gatheringService;

    public function __construct(
        AdminAuditService $auditService,
        AdminGatheringService $gatheringService
    ) {
        parent::__construct($auditService);
        $this->gatheringService = $gatheringService;
    }

    /**
     * Êé°ÈõÜÁÆ°ÁêÜ„Éà„ÉÉ„Éó„Éö„Éº„Ç∏
     */
    public function index(Request $request)
    {
        $this->initializeForRequest();
        $this->checkPermission('gathering.view');
        $this->trackPageAccess('gathering.index');

        try {
            // „Éï„Ç£„É´„ÇøÂá¶ÁêÜ
            $filters = $request->only(['route_id', 'item_category', 'skill_level', 'is_active']);
            
            // „Éá„Éº„ÇøÂèñÂæó
            $gatheringMappings = $this->gatheringService->getGatheringMappings($filters);
            $routeStats = $this->gatheringService->getGatheringStatsByRoute();
            $routes = Route::whereIn('category', ['road', 'dungeon'])->orderBy('name')->get();
            $itemCategories = Item::distinct('category')->pluck('category');

            $this->auditLog('gathering.index.viewed', [
                'total_mappings' => $gatheringMappings->count(),
                'filters' => $filters,
            ], 'low');

            return view('admin.gathering.index', compact(
                'gatheringMappings',
                'routeStats', 
                'routes',
                'itemCategories',
                'filters'
            ));

        } catch (\Exception $e) {
            $this->auditLog('gathering.index.failed', [
                'error' => $e->getMessage()
            ], 'high');
            
            return view('admin.gathering.index', [
                'error' => 'Êé°ÈõÜ„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' . $e->getMessage(),
                'gatheringMappings' => collect(),
                'routeStats' => [],
                'routes' => collect(),
                'itemCategories' => collect(),
                'filters' => [],
            ]);
        }
    }

    /**
     * Êé°ÈõÜ„Éû„ÉÉ„Éî„É≥„Ç∞‰ΩúÊàê
     */
    public function store(Request $request)
    {
        $this->initializeForRequest();
        $this->checkPermission('gathering.create');

        $validated = $request->validate([
            'route_id' => ['required', 'string', Rule::exists('routes', 'id')],
            'item_id' => ['required', 'integer', Rule::exists('items', 'id')],
            'required_skill_level' => ['required', 'integer', 'min:1', 'max:100'],
            'success_rate' => ['required', 'integer', 'min:1', 'max:100'],
            'quantity_min' => ['required', 'integer', 'min:1'],
            'quantity_max' => ['required', 'integer', 'min:1', 'gte:quantity_min'],
            'is_active' => ['boolean'],
        ]);

        try {
            // Êï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å
            $validationErrors = $this->gatheringService->validateGatheringData($validated);
            if (!empty($validationErrors)) {
                return back()->withInput()
                            ->withErrors(['validation' => $validationErrors])
                            ->with('error', 'ÂÖ•Âäõ„Éá„Éº„Çø„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô: ' . implode(', ', $validationErrors));
            }

            DB::beginTransaction();

            $mapping = GatheringMapping::create($validated);

            $this->auditLog('gathering.mapping.created', [
                'mapping_id' => $mapping->id,
                'route_id' => $mapping->route_id,
                'item_id' => $mapping->item_id,
                'data' => $validated,
            ], 'medium');

            DB::commit();

            return redirect()->route('admin.gathering.index')
                           ->with('success', 'Êé°ÈõÜ„Éû„ÉÉ„Éî„É≥„Ç∞„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü„ÄÇ');

        } catch (\Exception $e) {
            DB::rollBack();
            
            $this->auditLog('gathering.mapping.create_failed', [
                'data' => $validated,
                'error' => $e->getMessage(),
            ], 'high');

            return back()->withInput()
                        ->with('error', 'Êé°ÈõÜ„Éû„ÉÉ„Éî„É≥„Ç∞„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' . $e->getMessage());
        }
    }

    // update, destroyÁ≠â„ÅÆÂÆüË£Ö...
}
```

#### B. **AdminRoadController Êã°Âºµ**
```php
// Êó¢Â≠ò„ÅÆAdminRoadController „Å´Êé°ÈõÜÊ©üËÉΩËøΩÂä†

/**
 * RoadË©≥Á¥∞Ë°®Á§∫ÔºàÊé°ÈõÜÊÉÖÂ†±‰ªò„ÅçÔºâ
 */
public function show(Request $request, string $id)
{
    $this->initializeForRequest();
    $this->checkPermission('locations.view');

    try {
        $road = Route::whereIn('category', ['road', 'dungeon'])
                    ->with(['gatheringMappings.item'])
                    ->where('id', $id)
                    ->first();

        if (!$road) {
            return redirect()->route('admin.roads.index')
                           ->with('error', 'Route „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
        }

        // Êé°ÈõÜÁµ±Ë®àË®àÁÆó
        $gatheringStats = [
            'total_items' => $road->gatheringMappings->count(),
            'active_items' => $road->gatheringMappings->where('is_active', true)->count(),
            'route_type' => $road->route_type,
            'skill_level_range' => [
                'min' => $road->gatheringMappings->min('required_skill_level') ?? 0,
                'max' => $road->gatheringMappings->max('required_skill_level') ?? 0,
            ],
            'success_rate_avg' => round($road->gatheringMappings->avg('success_rate') ?? 0, 1),
        ];

        $this->auditLog('roads.show.viewed', [
            'road_id' => $id,
            'road_name' => $road->name,
            'route_type' => $road->route_type,
            'gathering_items_count' => $gatheringStats['total_items'],
        ]);

        return view('admin.roads.show', compact('road', 'gatheringStats'));

    } catch (\Exception $e) {
        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
    }
}
```

### 5. **„É´„Éº„ÉÜ„Ç£„É≥„Ç∞Ë®≠Ë®à**

#### routes/admin.php Êã°Âºµ
```php
// Êé°ÈõÜÁÆ°ÁêÜÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
Route::middleware(['admin.permission:gathering.view'])->group(function () {
    Route::get('/gathering', [AdminGatheringController::class, 'index'])
         ->name('gathering.index');
    Route::get('/gathering/stats', [AdminGatheringController::class, 'stats'])
         ->name('gathering.stats');
    Route::get('/gathering/export', [AdminGatheringController::class, 'export'])
         ->name('gathering.export');
         
    Route::middleware(['admin.permission:gathering.create'])->group(function () {
        Route::get('/gathering/create', [AdminGatheringController::class, 'create'])
             ->name('gathering.create');
        Route::post('/gathering', [AdminGatheringController::class, 'store'])
             ->name('gathering.store');
        Route::post('/gathering/bulk-import', [AdminGatheringController::class, 'bulkImport'])
             ->name('gathering.bulk-import');
    });
    
    Route::middleware(['admin.permission:gathering.edit'])->group(function () {
        Route::get('/gathering/{mapping}/edit', [AdminGatheringController::class, 'edit'])
             ->name('gathering.edit');
        Route::put('/gathering/{mapping}', [AdminGatheringController::class, 'update'])
             ->name('gathering.update');
        Route::patch('/gathering/{mapping}/toggle', [AdminGatheringController::class, 'toggle'])
             ->name('gathering.toggle');
    });
    
    Route::middleware(['admin.permission:gathering.delete'])->group(function () {
        Route::delete('/gathering/{mapping}', [AdminGatheringController::class, 'destroy'])
             ->name('gathering.destroy');
    });
});

// RoadÁÆ°ÁêÜ„ÅÆÊé°ÈõÜ„Çµ„ÉñÊ©üËÉΩ
Route::middleware(['admin.permission:locations.view'])->group(function () {
    Route::get('/roads/{road}/gathering', [AdminRoadController::class, 'gatheringSettings'])
         ->name('roads.gathering');
    Route::post('/roads/{road}/gathering/quick-add', [AdminRoadController::class, 'quickAddGathering'])
         ->name('roads.gathering.quick-add');
});
```

### 6. **„Éì„É•„Éº„ÉÜ„É≥„Éó„É¨„Éº„ÉàË®≠Ë®à**

#### A. **„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Áµ±Âêà**
```php
{{-- resources/views/admin/layouts/app.blade.php Êõ¥Êñ∞ --}}

<!-- „Éû„ÉÉ„ÉóÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ÂÜÖ„Å´Êé°ÈõÜÁÆ°ÁêÜËøΩÂä† -->
<div class="admin-nav-submenu">
    <a href="{{ route('admin.roads.index') }}" class="admin-nav-subitem {{ request()->routeIs('admin.roads*') ? 'active' : '' }}">
        <svg class="admin-nav-icon">...</svg>
        ÈÅìË∑ØÁÆ°ÁêÜ
    </a>
    {{-- Êñ∞Ë¶èËøΩÂä† --}}
    <a href="{{ route('admin.gathering.index') }}" class="admin-nav-subitem {{ request()->routeIs('admin.gathering*') ? 'active' : '' }}">
        <svg class="admin-nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
        Êé°ÈõÜÁÆ°ÁêÜ
    </a>
    <a href="{{ route('admin.towns.index') }}" class="admin-nav-subitem {{ request()->routeIs('admin.towns*') ? 'active' : '' }}">
        <svg class="admin-nav-icon">...</svg>
        Áî∫ÁÆ°ÁêÜ
    </a>
    <!-- Êó¢Â≠òÈ†ÖÁõÆ... -->
</div>
```

#### B. **„É°„Ç§„É≥ÁÆ°ÁêÜÁîªÈù¢„ÉÜ„É≥„Éó„É¨„Éº„Éà**
```php
{{-- resources/views/admin/gathering/index.blade.php --}}
@extends('admin.layouts.app')

@section('title', 'Êé°ÈõÜÁÆ°ÁêÜ')
@section('subtitle', '„Ç≤„Éº„É†ÂÜÖÊé°ÈõÜ„Ç∑„Çπ„ÉÜ„É†„ÅÆÁµ±ÂêàÁÆ°ÁêÜ')

@section('content')
<div class="admin-content-container">
    
    <!-- „Éö„Éº„Ç∏„Éò„ÉÉ„ÉÄ„Éº -->
    <div class="page-header">
        <div class="page-header-left">
            <h1 class="page-title">Êé°ÈõÜÁÆ°ÁêÜ</h1>
            <p class="page-subtitle">ÂêÑ„É´„Éº„Éà„Åß„ÅÆÊé°ÈõÜÂèØËÉΩ„Ç¢„Ç§„ÉÜ„É†„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åô</p>
        </div>
        <div class="page-header-actions">
            @if(auth()->user()->can('gathering.create'))
            <a href="{{ route('admin.gathering.create') }}" class="admin-btn admin-btn-primary">
                <i class="fas fa-plus"></i> Êñ∞„Åó„ÅÑÊé°ÈõÜË®≠ÂÆö
            </a>
            @endif
            @if(auth()->user()->can('gathering.view'))
            <a href="{{ route('admin.gathering.stats') }}" class="admin-btn admin-btn-info">
                <i class="fas fa-chart-bar"></i> Áµ±Ë®àË°®Á§∫
            </a>
            @endif
        </div>
    </div>

    <!-- Áµ±Ë®à„Çµ„Éû„É™„Éº -->
    <div class="admin-stats-grid">
        <div class="admin-stat-card">
            <div class="admin-stat-icon bg-primary">
                <i class="fas fa-map"></i>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-label">Êé°ÈõÜÂèØËÉΩ„É´„Éº„Éà</div>
                <div class="admin-stat-value">{{ count($routeStats) }}</div>
                <div class="admin-stat-subtitle">
                    ÈÅìË∑Ø: {{ collect($environmentStats)->where('category', 'road')->first()['total_routes'] ?? 0 }} / 
                    „ÉÄ„É≥„Ç∏„Éß„É≥: {{ collect($environmentStats)->where('category', 'dungeon')->first()['total_routes'] ?? 0 }}
                </div>
            </div>
        </div>
        
        <div class="admin-stat-card">
            <div class="admin-stat-icon bg-success">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-label">Á∑èÊé°ÈõÜ„Ç¢„Ç§„ÉÜ„É†</div>
                <div class="admin-stat-value">{{ $gatheringMappings->count() }}</div>
                <div class="admin-stat-subtitle">
                    Áí∞Â¢ÉÂà•Ë®≠ÂÆö: {{ $gatheringMappings->groupBy('gathering_environment')->count() }}Á®ÆÈ°û
                </div>
            </div>
        </div>
        
        <div class="admin-stat-card">
            <div class="admin-stat-icon bg-info">
                <i class="fas fa-toggle-on"></i>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-label">„Ç¢„ÇØ„ÉÜ„Ç£„ÉñË®≠ÂÆö</div>
                <div class="admin-stat-value">{{ $gatheringMappings->where('is_active', true)->count() }}</div>
                <div class="admin-stat-subtitle">
                    „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™Êé°ÈõÜË®≠ÂÆöÊï∞
                </div>
            </div>
        </div>
        
        <div class="admin-stat-card">
            <div class="admin-stat-icon bg-warning">
                <i class="fas fa-dungeon"></i>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-label">„ÉÄ„É≥„Ç∏„Éß„É≥Êé°ÈõÜ</div>
                <div class="admin-stat-value">{{ $gatheringMappings->where('gathering_environment', 'dungeon')->count() }}</div>
                <div class="admin-stat-subtitle">
                    „ÉÄ„É≥„Ç∏„Éß„É≥Áí∞Â¢É„Åß„ÅÆÊé°ÈõÜË®≠ÂÆö
                </div>
            </div>
        </div>
    </div>

    <!-- „Éï„Ç£„É´„Çø„É™„É≥„Ç∞ -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3>„Éï„Ç£„É´„Çø„ÉªÊ§úÁ¥¢</h3>
        </div>
        <div class="admin-card-body">
            <form method="GET" action="{{ route('admin.gathering.index') }}" class="admin-filter-form">
                <div class="admin-filter-row">
                    <div class="admin-form-group">
                        <label class="admin-form-label">„É´„Éº„Éà</label>
                        <select name="route_id" class="admin-form-input">
                            <option value="">ÂÖ®„Å¶„ÅÆ„É´„Éº„Éà</option>
                            @foreach($routes as $route)
                            <option value="{{ $route->id }}" {{ request('route_id') === $route->id ? 'selected' : '' }}>
                                [{{ $route->category === 'road' ? 'ÈÅìË∑Ø' : '„ÉÄ„É≥„Ç∏„Éß„É≥' }}] {{ $route->name }}
                            </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label class="admin-form-label">Êé°ÈõÜÁí∞Â¢É</label>
                        <select name="gathering_environment" class="admin-form-input">
                            <option value="">ÂÖ®„Å¶„ÅÆÁí∞Â¢É</option>
                            @foreach($gatheringEnvironments as $env)
                            <option value="{{ $env }}" {{ request('gathering_environment') === $env ? 'selected' : '' }}>
                                {{ $env === 'road' ? 'ÈÅìË∑Ø' : '„ÉÄ„É≥„Ç∏„Éß„É≥' }}
                            </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label class="admin-form-label">„Ç¢„Ç§„ÉÜ„É†„Ç´„ÉÜ„Ç¥„É™</label>
                        <select name="item_category" class="admin-form-input">
                            <option value="">ÂÖ®„Å¶„ÅÆ„Ç´„ÉÜ„Ç¥„É™</option>
                            @foreach($itemCategories as $category)
                            <option value="{{ $category }}" {{ request('item_category') === $category ? 'selected' : '' }}>
                                {{ $category }}
                            </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label class="admin-form-label">Áä∂ÊÖã</label>
                        <select name="is_active" class="admin-form-input">
                            <option value="">ÂÖ®„Å¶„ÅÆÁä∂ÊÖã</option>
                            <option value="1" {{ request('is_active') === '1' ? 'selected' : '' }}>„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                            <option value="0" {{ request('is_active') === '0' ? 'selected' : '' }}>Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</option>
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label class="admin-form-label">&nbsp;</label>
                        <button type="submit" class="admin-btn admin-btn-primary">„Éï„Ç£„É´„ÇøÈÅ©Áî®</button>
                        <a href="{{ route('admin.gathering.index') }}" class="admin-btn admin-btn-secondary">„É™„Çª„ÉÉ„Éà</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Êé°ÈõÜË®≠ÂÆö‰∏ÄË¶ß -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3>Êé°ÈõÜË®≠ÂÆö‰∏ÄË¶ß</h3>
        </div>
        <div class="admin-card-body">
            @if($gatheringMappings->count() > 0)
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>„É´„Éº„Éà</th>
                            <th>„Ç¢„Ç§„ÉÜ„É†</th>
                            <th>ÂøÖË¶Å„Çπ„Ç≠„É´Lv</th>
                            <th>ÊàêÂäüÁéá</th>
                            <th>Êï∞ÈáèÁØÑÂõ≤</th>
                            <th>Áä∂ÊÖã</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($gatheringMappings as $mapping)
                        <tr>
                            <td>
                                <span class="admin-badge admin-badge-{{ $mapping->route->category === 'road' ? 'primary' : 'secondary' }}">
                                    {{ $mapping->route->name }}
                                </span>
                            </td>
                            <td>
                                <div class="item-info">
                                    <strong>{{ $mapping->item->name }}</strong>
                                    <small class="text-muted">{{ $mapping->item->getCategoryName() }}</small>
                                </div>
                            </td>
                            <td>
                                <span class="admin-badge admin-badge-info">
                                    Lv.{{ $mapping->required_skill_level }}
                                </span>
                            </td>
                            <td>
                                <div class="success-rate">
                                    <span class="rate-value">{{ $mapping->success_rate }}%</span>
                                    <div class="rate-bar">
                                        <div class="rate-fill" style="width: {{ $mapping->success_rate }}%"></div>
                                    </div>
                                </div>
                            </td>
                            <td>{{ $mapping->quantity_min }}-{{ $mapping->quantity_max }}</td>
                            <td>
                                <span class="admin-badge admin-badge-{{ $mapping->is_active ? 'success' : 'danger' }}">
                                    {{ $mapping->is_active ? '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ' : 'Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ' }}
                                </span>
                            </td>
                            <td>
                                <div class="admin-action-buttons">
                                    @if(auth()->user()->can('gathering.edit'))
                                    <a href="{{ route('admin.gathering.edit', $mapping) }}" class="admin-btn admin-btn-sm admin-btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    @endif
                                    @if(auth()->user()->can('gathering.delete'))
                                    <form method="POST" action="{{ route('admin.gathering.destroy', $mapping) }}" style="display: inline;" onsubmit="return confirm('„Åì„ÅÆÊé°ÈõÜË®≠ÂÆö„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')">
                                        @csrf
                                        @method('DELETE')
                                        <button type="submit" class="admin-btn admin-btn-sm admin-btn-danger">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                    @endif
                                </div>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
            @else
            <div class="admin-empty-state">
                <div class="admin-empty-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <h3>Êé°ÈõÜË®≠ÂÆö„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                <p>„Åæ„Å†Êé°ÈõÜË®≠ÂÆö„Åå‰ΩúÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÊñ∞„Åó„ÅÑÊé°ÈõÜË®≠ÂÆö„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                @if(auth()->user()->can('gathering.create'))
                <a href="{{ route('admin.gathering.create') }}" class="admin-btn admin-btn-primary">
                    <i class="fas fa-plus"></i> ÊúÄÂàù„ÅÆÊé°ÈõÜË®≠ÂÆö„Çí‰ΩúÊàê
                </a>
                @endif
            </div>
            @endif
        </div>
    </div>
</div>
@endsection

@section('scripts')
<script>
// Êé°ÈõÜÁÆ°ÁêÜÁîªÈù¢Â∞ÇÁî®JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // ÊàêÂäüÁéá„Éê„Éº„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
    const rateBars = document.querySelectorAll('.rate-fill');
    rateBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
            bar.style.transition = 'width 0.5s ease-in-out';
        }, 100);
    });
});
</script>
@endsection
```

### 7. **Êó¢Â≠òGatheringControllerÊõ¥Êñ∞**

#### Êñ∞DBÂØæÂøú„É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞
```php
// app/Http/Controllers/GatheringController.php Êõ¥Êñ∞

public function gather(Request $request): JsonResponse
{
    $user = Auth::user();
    $player = $user->getOrCreatePlayer();
    
    // Road„ÉªDungeonÊé°ÈõÜÂØæÂøú„ÉÅ„Çß„ÉÉ„ÇØ
    if (!in_array($player->location_type, ['road', 'dungeon'])) {
        return response()->json(['error' => 'Êé°ÈõÜ„ÅØÈÅìË∑Ø„Åæ„Åü„ÅØ„ÉÄ„É≥„Ç∏„Éß„É≥„Åß„ÅÆ„ÅøÂèØËÉΩ„Åß„Åô„ÄÇ'], 400);
    }

    // Êé°ÈõÜ„Çπ„Ç≠„É´„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    if (!$player->hasSkill('Êé°ÈõÜ')) {
        return response()->json(['error' => 'Êé°ÈõÜ„Çπ„Ç≠„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ'], 400);
    }
    
    $gatheringSkill = $player->getSkill('Êé°ÈõÜ');
    $spCost = $gatheringSkill->getSkillSpCost();

    if ($player->sp < $spCost) {
        return response()->json(['error' => 'SP„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ'], 400);
    }

    try {
        // Êñ∞DBÊñπÂºèÔºöGatheringMapping„Åã„ÇâÊé°ÈõÜÂèØËÉΩ„Ç¢„Ç§„ÉÜ„É†ÂèñÂæó
        $availableItems = GatheringMapping::where('route_id', $player->location_id)
            ->where('is_active', true)
            ->forSkillLevel($gatheringSkill->level)
            ->with('item')
            ->get();

        if ($availableItems->isEmpty()) {
            return response()->json(['error' => '„Åì„ÅÆ„Ç®„É™„Ç¢„Åß„ÅØÊé°ÈõÜ„Åß„Åç„Çã„Ç¢„Ç§„ÉÜ„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ'], 400);
        }

        // Èáç„Åø‰ªò„Åç„É©„É≥„ÉÄ„É†ÈÅ∏Êäû
        $selectedMapping = $this->selectRandomMapping($availableItems);
        
        // ÊàêÂäüÁéáË®àÁÆóÔºà„Çπ„Ç≠„É´„É¨„Éô„É´„Éú„Éº„Éä„ÇπÈÅ©Áî®Ôºâ
        $actualSuccessRate = $selectedMapping->calculateSuccessRate($gatheringSkill->level);
        $success = mt_rand(1, 100) <= $actualSuccessRate;

        if (!$success) {
            // SPÊ∂àË≤ª
            $player->sp -= $spCost;
            $player->save();

            return response()->json([
                'success' => false,
                'message' => 'Êé°ÈõÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü...',
                'sp_consumed' => $spCost,
                'remaining_sp' => $player->sp,
            ]);
        }

        // ÊàêÂäüÊôÇ„ÅÆÂá¶ÁêÜ
        $quantity = mt_rand($selectedMapping->quantity_min, $selectedMapping->quantity_max);
        
        // „Ç§„É≥„Éô„É≥„Éà„É™„Å´ËøΩÂä†
        $player->addItemToInventory($selectedMapping->item->id, $quantity);
        
        // SPÊ∂àË≤ª & ÁµåÈ®ìÂÄ§Áç≤Âæó
        $player->sp -= $spCost;
        $experienceGained = $this->calculateGatheringExperience($selectedMapping, $quantity);
        $gatheringSkill->addExperience($experienceGained);
        
        $player->save();

        return response()->json([
            'success' => true,
            'item_obtained' => [
                'name' => $selectedMapping->item->name,
                'quantity' => $quantity,
            ],
            'sp_consumed' => $spCost,
            'remaining_sp' => $player->sp,
            'experience_gained' => $experienceGained,
            'skill_level' => $gatheringSkill->level,
        ]);

    } catch (\Exception $e) {
        Log::error('Gathering failed', [
            'player_id' => $player->id,
            'location_id' => $player->location_id,
            'error' => $e->getMessage()
        ]);

        return response()->json([
            'error' => 'Êé°ÈõÜÂá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ'
        ], 500);
    }
}

public function getGatheringInfo(Request $request): JsonResponse
{
    $user = Auth::user();
    $player = $user->getOrCreatePlayer();
    
    if (!in_array($player->location_type, ['road', 'dungeon'])) {
        return response()->json(['error' => 'Êé°ÈõÜÊÉÖÂ†±„ÅØÈÅìË∑Ø„Åæ„Åü„ÅØ„ÉÄ„É≥„Ç∏„Éß„É≥„Åß„ÅÆ„ÅøÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ'], 400);
    }

    $gatheringSkill = $player->getSkill('Êé°ÈõÜ');
    
    if (!$gatheringSkill) {
        return response()->json(['error' => 'Êé°ÈõÜ„Çπ„Ç≠„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ'], 400);
    }

    // Êñ∞DBÊñπÂºèÔºöÂÖ®Êé°ÈõÜ„Ç¢„Ç§„ÉÜ„É†ÂèñÂæó
    $allMappings = GatheringMapping::where('route_id', $player->location_id)
        ->where('is_active', true)
        ->with('item')
        ->orderBy('required_skill_level')
        ->get();

    $itemsWithStatus = $allMappings->map(function($mapping) use ($gatheringSkill) {
        $canGather = $mapping->required_skill_level <= $gatheringSkill->level;
        $actualSuccessRate = $canGather ? $mapping->calculateSuccessRate($gatheringSkill->level) : 0;
        
        return [
            'item_name' => $mapping->item->name,
            'required_skill_level' => $mapping->required_skill_level,
            'base_success_rate' => $mapping->success_rate,
            'actual_success_rate' => $actualSuccessRate,
            'quantity_range' => $mapping->quantity_min . '-' . $mapping->quantity_max,
            'can_gather' => $canGather,
        ];
    });

    $currentLocation = Route::find($player->location_id);

    return response()->json([
        'skill_level' => $gatheringSkill->level,
        'experience' => $gatheringSkill->experience,
        'sp_cost' => $gatheringSkill->sp_cost,
        'current_sp' => $player->sp,
        'can_gather' => $player->sp >= $gatheringSkill->sp_cost,
        'road_name' => $currentLocation?->name ?? '‰∏çÊòé„Å™„Ç®„É™„Ç¢',
        'all_items' => $itemsWithStatus,
        'available_items_count' => $itemsWithStatus->where('can_gather', true)->count(),
    ]);
}

/**
 * „É©„É≥„ÉÄ„É†ÈÅ∏ÊäûÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
 */
private function selectRandomMapping($mappings): GatheringMapping
{
    return $mappings->random();
}

/**
 * Êé°ÈõÜÁµåÈ®ìÂÄ§Ë®àÁÆóÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
 */
private function calculateGatheringExperience(GatheringMapping $mapping, int $quantity): int
{
    $baseExp = $mapping->required_skill_level * 2;
    $quantityBonus = $quantity - 1;
    
    return $baseExp + $quantityBonus;
}
```

---

## üöÄ ÂÆüË£Ö„Çπ„ÉÜ„ÉÉ„Éó

### Phase 1: Âü∫Áõ§ÊßãÁØâÔºà1-2Êó•Ôºâ
1. **„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥‰ΩúÊàê„ÉªÂÆüË°å**
   - `gathering_mappings` „ÉÜ„Éº„Éñ„É´‰ΩúÊàê
   - „Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÊúÄÈÅ©Âåñ
   
2. **„É¢„Éá„É´„Éª„É™„É¨„Éº„Ç∑„Éß„É≥ÂÆüË£Ö**
   - `GatheringMapping` „É¢„Éá„É´‰ΩúÊàê
   - `Route` „É¢„Éá„É´Êã°Âºµ
   - „É™„É¨„Éº„Ç∑„Éß„É≥Ë®≠ÂÆö

3. **„Çµ„Éº„Éì„Çπ„ÇØ„É©„ÇπÂÆüË£Ö**
   - `AdminGatheringService` ‰ΩúÊàê
   - Âü∫Êú¨CRUDÊìç‰ΩúÂÆüË£Ö

### Phase 2: ÁÆ°ÁêÜÁîªÈù¢ÂÆüË£ÖÔºà2-3Êó•Ôºâ
1. **„Ç≥„É≥„Éà„É≠„Éº„É©„ÉºÂÆüË£Ö**
   - `AdminGatheringController` ‰ΩúÊàê
   - AdminControllerÂü∫Â∫ï„ÇØ„É©„ÇπÁ∂ôÊâø
   - Ê®©Èôê„ÉÅ„Çß„ÉÉ„ÇØÁµ±Âêà

2. **„É´„Éº„ÉÜ„Ç£„É≥„Ç∞Ë®≠ÂÆö**
   - Ê®©Èôê„Ç∞„É´„Éº„ÉóÂåñ
   - RESTfulË®≠Ë®àÈÅ©Áî®

3. **„Éì„É•„Éº„ÉÜ„É≥„Éó„É¨„Éº„Éà‰ΩúÊàê**
   - Áµ±‰∏Ä„Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†ÈÅ©Áî®
   - „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú
   - „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Áµ±Âêà

### Phase 3: „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØÊõ¥Êñ∞Ôºà1-2Êó•Ôºâ
1. **GatheringController „É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞**
   - DBÈßÜÂãï„É≠„Ç∏„ÉÉ„ÇØ„Å∏ÁßªË°å
   - Êó¢Â≠òAPI‰∫íÊèõÊÄßÁ∂≠ÊåÅ
   - „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑Âåñ

2. **„Éá„Éº„ÇøÁßªË°åÂá¶ÁêÜ**
   - Êó¢Â≠ò„Éè„Éº„Éâ„Ç≥„Éº„Éâ„Éá„Éº„Çø„ÅÆDBÁßªË°å
   - „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„ÉªÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ

### Phase 4: „ÉÜ„Çπ„Éà„ÉªÊúÄÈÅ©ÂåñÔºà1-2Êó•Ôºâ
1. **Ê©üËÉΩ„ÉÜ„Çπ„Éà**
   - Ê®©Èôê„ÉÜ„Çπ„Éà
   - CRUDÊìç‰Ωú„ÉÜ„Çπ„Éà
   - „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØÊï¥ÂêàÊÄß„ÉÜ„Çπ„Éà

2. **„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ**
   - „ÇØ„Ç®„É™ÊúÄÈÅ©Âåñ
   - „Ç≠„É£„ÉÉ„Ç∑„É•Êà¶Áï•ÂÆüË£Ö
   - „Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπË™øÊï¥

3. **UI/UX„ÉÜ„Çπ„Éà**
   - „É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà
   - „É¨„Çπ„Éù„É≥„Ç∑„Éñ„ÉÜ„Çπ„Éà
   - „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Á¢∫Ë™ç

---

## üéØ „Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ

### üìã „Çª„Ç≠„É•„É™„ÉÜ„Ç£
- **Ê®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ**: ÂÖ®„É°„ÇΩ„ÉÉ„Éâ„Åß `$this->checkPermission()` ÂÆüË°å
- **Áõ£Êüª„É≠„Ç∞**: ÈáçË¶ÅÊìç‰Ωú„ÅÆÂÆåÂÖ®Ë®òÈå≤
- **ÂÖ•ÂäõÊ§úË®º**: Laravel Validation „Å´„Çà„ÇãÂé≥ÂØÜ„Å™„ÉÅ„Çß„ÉÉ„ÇØ
- **SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ÂØæÁ≠ñ**: Eloquent ORM ‰ΩøÁî®

### üîß „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ
- **Eager Loading**: N+1„ÇØ„Ç®„É™ÂïèÈ°å„ÅÆÂõûÈÅø
- **„Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÊúÄÈÅ©Âåñ**: Ê§úÁ¥¢„Éª„Éï„Ç£„É´„ÇøÊÄßËÉΩÂêë‰∏ä
- **„Ç≠„É£„ÉÉ„Ç∑„É•Ê¥ªÁî®**: Áµ±Ë®à„Éá„Éº„Çø„ÅÆÈÅ©Âàá„Å™„Ç≠„É£„ÉÉ„Ç∑„É•
- **„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥**: Â§ßÈáè„Éá„Éº„ÇøÂØæÂøú

### üé® UI/UX
- **Áµ±‰∏Ä„Éá„Ç∂„Ç§„É≥**: „Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†Â§âÊï∞„ÅÆÂÆåÂÖ®Ê¥ªÁî®
- **„É¨„Çπ„Éù„É≥„Ç∑„Éñ**: „É¢„Éê„Ç§„É´ÂØæÂøú
- **„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ**: Êìç‰ΩúÁµêÊûú„ÅÆÊòéÁ¢∫„Å™Ë°®Á§∫
- **„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£**: „Çπ„ÇØ„É™„Éº„É≥„É™„Éº„ÉÄ„ÉºÂØæÂøú

### üöÄ Êã°ÂºµÊÄß
- **„É¢„Ç∏„É•„É©„ÉºË®≠Ë®à**: Ê©üËÉΩÂçò‰Ωç„Åß„ÅÆÂàÜÈõ¢
- **Ë®≠ÂÆöÈßÜÂãï**: „Éè„Éº„Éâ„Ç≥„Éº„ÉâÂÄ§„ÅÆÊéíÈô§
- **APIË®≠Ë®à**: Â∞ÜÊù•„ÅÆ„Éï„É≠„É≥„Éà„Ç®„É≥„ÉâÂàÜÈõ¢ÂØæÂøú
- **„Éâ„Ç≠„É•„É°„É≥„Éà**: ‰øùÂÆàÊÄßÂêë‰∏ä„ÅÆ„Åü„ÇÅ„ÅÆË©≥Á¥∞Ë®òÈå≤

---

## ‚úÖ ÂÆå‰∫ÜÂü∫Ê∫ñ

### Ê©üËÉΩË¶Å‰ª∂
- [ ] `gathering_mappings` „ÉÜ„Éº„Éñ„É´‰ΩúÊàê„Éª„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü
- [ ] AdminÁÆ°ÁêÜÁîªÈù¢„Åß„ÅÆÊé°ÈõÜË®≠ÂÆöCRUDÊìç‰ΩúÂèØËÉΩ
- [ ] Routes-GatheringMapping „ÅÆ1ÂØæ1Á¥ê‰ªò„ÅëÊ©üËÉΩÂÆüË£Ö
- [ ] Êó¢Â≠ò„Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ„ÅÆDBÈßÜÂãï„Å∏„ÅÆÂÆåÂÖ®ÁßªË°å
- [ ] „É¨„Éï„Ç°„É¨„É≥„Çπ„Éâ„Ç≠„É•„É°„É≥„ÉàÊ∫ñÊã†„ÅÆÂÆüË£Ö

### ÊäÄË°ìË¶Å‰ª∂
- [ ] AdminControllerÂü∫Â∫ï„ÇØ„É©„ÇπÁ∂ôÊâø
- [ ] Ê®©Èôê„Éô„Éº„Çπ„Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°Áµ±Âêà
- [ ] Áõ£Êüª„É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†ÈÄ£Êê∫
- [ ] Áµ±‰∏Ä„Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†ÈÅ©Áî®
- [ ] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Éª„Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÂÆüË£Ö

### ÂìÅË≥™Ë¶Å‰ª∂
- [ ] „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„ÉàÂêàÊ†º
- [ ] „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÂêàÊ†º
- [ ] UI/UX„ÉÜ„Çπ„ÉàÂêàÊ†º
- [ ] „Éâ„Ç≠„É•„É°„É≥„ÉàÊï¥ÂÇôÂÆå‰∫Ü

---

**‰ΩúÊàêËÄÖ**: GitHub Copilot  
**ÊúÄÁµÇÊõ¥Êñ∞**: 2025Âπ¥8Êúà25Êó•  
**„Éê„Éº„Ç∏„Éß„É≥**: 1.0  
**Êé®ÂÆöÂÆüË£ÖÊúüÈñì**: 6-9Êó•  
**ÂÑ™ÂÖàÂ∫¶**: High  
**Ë§áÈõëÂ∫¶**: Medium-High  
