@extends('admin.layouts.app')

@section('title', '„Çπ„Éù„Éº„É≥Á∑®ÈõÜ')
@section('subtitle', $spawn->gameLocation->name . ' „ÅÆ„É¢„É≥„Çπ„Çø„Éº„Çπ„Éù„Éº„É≥Á∑®ÈõÜ')

@section('content')
<div class="admin-content-container">
    
    <!-- „Éë„É≥„Åè„Åö„É™„Çπ„Éà -->
    <nav style="margin-bottom: 2rem;">
        <ol style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: var(--admin-secondary);">
            <li><a href="{{ route('admin.dashboard') }}" style="color: var(--admin-primary);">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</a></li>
            <li>/</li>
            <li><a href="{{ route('admin.monster-spawns.index') }}" style="color: var(--admin-primary);">„É¢„É≥„Çπ„Çø„Éº„Çπ„Éù„Éº„É≥ÁÆ°ÁêÜ</a></li>
            <li>/</li>
            <li><a href="{{ route('admin.monster-spawns.show', $spawn->location_id) }}" style="color: var(--admin-primary);">{{ $spawn->gameLocation->name }}</a></li>
            <li>/</li>
            <li>Á∑®ÈõÜ</li>
        </ol>
    </nav>

    <!-- ÁèæÂú®„ÅÆË®≠ÂÆöË°®Á§∫„Ç´„Éº„Éâ -->
    <div class="admin-card" style="margin-bottom: 2rem;">
        <div class="admin-card-header">
            <h3 class="admin-card-title">Á∑®ÈõÜ‰∏≠„ÅÆ„Çπ„Éù„Éº„É≥Ë®≠ÂÆö</h3>
        </div>
        <div class="admin-card-body">
            <div style="display: flex; align-items: center; gap: 2rem;">
                <!-- ÁèæÂú®„ÅÆ„É¢„É≥„Çπ„Çø„ÉºÊÉÖÂ†± -->
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="font-size: 3rem;">{{ $spawn->monster->emoji ?? 'üëπ' }}</div>
                    <div>
                        <div style="font-weight: bold; font-size: 1.2rem;">{{ $spawn->monster->name }}</div>
                        <div style="color: var(--admin-secondary); font-size: 0.875rem;">
                            Lv.{{ $spawn->monster->level }} | HP: {{ number_format($spawn->monster->max_hp) }} | EXP: {{ number_format($spawn->monster->experience_reward) }}
                        </div>
                    </div>
                </div>

                <!-- ÁèæÂú®„ÅÆË®≠ÂÆöÂÄ§ -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; flex: 1;">
                    <div>
                        <div style="font-size: 0.875rem; color: var(--admin-secondary);">Âá∫ÁèæÁéá</div>
                        <div style="font-weight: bold; color: var(--admin-info);">{{ round($spawn->spawn_rate * 100, 1) }}%</div>
                    </div>
                    <div>
                        <div style="font-size: 0.875rem; color: var(--admin-secondary);">ÂÑ™ÂÖàÂ∫¶</div>
                        <div style="font-weight: bold;">{{ $spawn->priority }}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.875rem; color: var(--admin-secondary);">„Çπ„ÉÜ„Éº„Çø„Çπ</div>
                        <span class="admin-badge admin-badge-{{ $spawn->is_active ? 'success' : 'secondary' }}">
                            {{ $spawn->is_active ? 'ÊúâÂäπ' : 'ÁÑ°Âäπ' }}
                        </span>
                    </div>
                </div>

                <!-- LocationÊÉÖÂ†± -->
                <div>
                    <div style="font-size: 0.875rem; color: var(--admin-secondary);">Location</div>
                    <div style="font-weight: 500;">{{ $spawn->gameLocation->name }}</div>
                    <span class="admin-badge admin-badge-{{ $spawn->gameLocation->category === 'road' ? 'primary' : 'info' }}">
                        {{ $spawn->gameLocation->category === 'road' ? 'ÈÅìË∑Ø' : '„ÉÄ„É≥„Ç∏„Éß„É≥' }}
                    </span>
                </div>
            </div>

            @if($spawn->min_level || $spawn->max_level)
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--admin-border);">
                <div style="font-size: 0.875rem; color: var(--admin-secondary); margin-bottom: 0.25rem;">„É¨„Éô„É´Âà∂Èôê</div>
                <div>
                    @if($spawn->min_level)
                        Lv.{{ $spawn->min_level }}‰ª•‰∏ä
                    @endif
                    @if($spawn->min_level && $spawn->max_level)
                        „ÄÅ
                    @endif
                    @if($spawn->max_level)
                        Lv.{{ $spawn->max_level }}‰ª•‰∏ã
                    @endif
                </div>
            </div>
            @endif
        </div>
    </div>

    <!-- Á∑®ÈõÜ„Éï„Ç©„Éº„É† -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">Ë®≠ÂÆöÂ§âÊõ¥</h3>
            <a href="{{ route('admin.monster-spawns.show', $spawn->location_id) }}" class="admin-btn admin-btn-secondary">
                ‚Üê Êàª„Çã
            </a>
        </div>
        <div class="admin-card-body">
            <form method="POST" action="{{ route('admin.monster-spawns.update', $spawn->id) }}" id="spawn-edit-form">
                @csrf
                @method('PUT')

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <!-- Â∑¶ÂÅ¥: Âü∫Êú¨Ë®≠ÂÆö -->
                    <div>
                        <h4 style="margin-bottom: 1.5rem; color: var(--admin-primary);">Âü∫Êú¨Ë®≠ÂÆö</h4>

                        <!-- „É¢„É≥„Çπ„Çø„ÉºÈÅ∏Êäû -->
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „É¢„É≥„Çπ„Çø„Éº <span style="color: var(--admin-danger);">*</span>
                            </label>
                            <select name="monster_id" class="admin-select" required onchange="updateMonsterPreview(this.value)">
                                @foreach($availableMonsters as $monster)
                                <option value="{{ $monster->id }}" 
                                        {{ (old('monster_id', $spawn->monster_id) === $monster->id) ? 'selected' : '' }}
                                        data-level="{{ $monster->level }}"
                                        data-hp="{{ $monster->max_hp }}"
                                        data-attack="{{ $monster->attack }}"
                                        data-defense="{{ $monster->defense }}"
                                        data-exp="{{ $monster->experience_reward }}"
                                        data-emoji="{{ $monster->emoji }}">
                                    {{ $monster->emoji ?? 'üëπ' }} {{ $monster->name }} (Lv.{{ $monster->level }})
                                </option>
                                @endforeach
                            </select>
                            @error('monster_id')
                            <div style="color: var(--admin-danger); font-size: 0.875rem; margin-top: 0.25rem;">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- Âá∫ÁèæÁéá -->
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                Âá∫ÁèæÁéá <span style="color: var(--admin-danger);">*</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <input type="number" name="spawn_rate" 
                                       value="{{ old('spawn_rate', $spawn->spawn_rate) }}" 
                                       class="admin-input" 
                                       min="0.001" max="1.0" 
                                       step="0.001" 
                                       style="width: 120px;"
                                       oninput="updateRateDisplay(this.value)"
                                       required>
                                <span id="rate-percentage" style="font-size: 1.1rem; font-weight: bold; color: var(--admin-info);">
                                    {{ round((old('spawn_rate', $spawn->spawn_rate)) * 100, 1) }}%
                                </span>
                            </div>
                            @php
                                $otherSpawnsTotalRate = $spawn->gameLocation->monsterSpawns
                                    ->where('id', '!=', $spawn->id)
                                    ->sum('spawn_rate');
                                $maxAllowedRate = 1.0 - $otherSpawnsTotalRate;
                            @endphp
                            <div style="font-size: 0.875rem; color: var(--admin-secondary); margin-top: 0.25rem;">
                                0.001 (0.1%) „Åã„Çâ {{ round($maxAllowedRate, 3) }} ({{ round($maxAllowedRate * 100, 1) }}%) „Åæ„Åß
                                @if($otherSpawnsTotalRate > 0)
                                <br><span style="color: var(--admin-info);">‰ªñ„ÅÆ„Çπ„Éù„Éº„É≥Á∑èË®à: {{ round($otherSpawnsTotalRate * 100, 1) }}%</span>
                                @endif
                            </div>
                            @error('spawn_rate')
                            <div style="color: var(--admin-danger); font-size: 0.875rem; margin-top: 0.25rem;">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ÂÑ™ÂÖàÂ∫¶ -->
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                ÂÑ™ÂÖàÂ∫¶ <span style="color: var(--admin-danger);">*</span>
                            </label>
                            <input type="number" name="priority" 
                                   value="{{ old('priority', $spawn->priority) }}" 
                                   class="admin-input" 
                                   min="0" max="999" 
                                   style="width: 120px;"
                                   required>
                            <div style="font-size: 0.875rem; color: var(--admin-secondary); margin-top: 0.25rem;">
                                Êï∞Â≠ó„ÅåÂ∞è„Åï„ÅÑ„Åª„Å©ÂÑ™ÂÖàÂ∫¶„ÅåÈ´ò„ÅÑ
                            </div>
                            @error('priority')
                            <div style="color: var(--admin-danger); font-size: 0.875rem; margin-top: 0.25rem;">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- „Çπ„ÉÜ„Éº„Çø„Çπ -->
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" name="is_active" value="1" 
                                       {{ old('is_active', $spawn->is_active) ? 'checked' : '' }}>
                                <span>ÊúâÂäπ</span>
                            </label>
                            <div style="font-size: 0.875rem; color: var(--admin-secondary); margin-top: 0.25rem;">
                                ÁÑ°Âäπ„Å´„Åô„Çã„Å®„ÄÅ„Åì„ÅÆ„Çπ„Éù„Éº„É≥Ë®≠ÂÆö„ÅØÂÆüÈöõ„ÅÆ„Ç≤„Éº„É†ÂÜÖ„Åß‰ΩøÁî®„Åï„Çå„Åæ„Åõ„Çì
                            </div>
                        </div>
                    </div>

                    <!-- Âè≥ÂÅ¥: È´òÂ∫¶„Å™Ë®≠ÂÆö -->
                    <div>
                        <h4 style="margin-bottom: 1.5rem; color: var(--admin-primary);">È´òÂ∫¶„Å™Ë®≠ÂÆöÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</h4>

                        <!-- „É¨„Éô„É´Âà∂Èôê -->
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">„Éó„É¨„Ç§„É§„Éº„É¨„Éô„É´Âà∂Èôê</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; color: var(--admin-secondary);">ÊúÄÂ∞è„É¨„Éô„É´</label>
                                    <input type="number" name="min_level" 
                                           value="{{ old('min_level', $spawn->min_level) }}" 
                                           class="admin-input" 
                                           min="1" max="999"
                                           placeholder="Âà∂Èôê„Å™„Åó">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; color: var(--admin-secondary);">ÊúÄÂ§ß„É¨„Éô„É´</label>
                                    <input type="number" name="max_level" 
                                           value="{{ old('max_level', $spawn->max_level) }}" 
                                           class="admin-input" 
                                           min="1" max="999"
                                           placeholder="Âà∂Èôê„Å™„Åó">
                                </div>
                            </div>
                            <div style="font-size: 0.875rem; color: var(--admin-secondary); margin-top: 0.5rem;">
                                ÊåáÂÆö„Åó„Åü„É¨„Éô„É´ÁØÑÂõ≤„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´„ÅÆ„Åø„ÄÅ„Åì„ÅÆ„É¢„É≥„Çπ„Çø„Éº„ÅåÂá∫Áèæ„Åó„Åæ„Åô
                            </div>
                            @error('min_level')
                            <div style="color: var(--admin-danger); font-size: 0.875rem; margin-top: 0.25rem;">{{ $message }}</div>
                            @enderror
                            @error('max_level')
                            <div style="color: var(--admin-danger); font-size: 0.875rem; margin-top: 0.25rem;">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- Â§âÊõ¥„Éó„É¨„Éì„É•„Éº -->
                        <div id="change-preview" style="padding: 1.5rem; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--admin-warning);">
                            <h5 style="margin-bottom: 1rem; color: var(--admin-warning);">‚ö†Ô∏è Â§âÊõ¥ÂÜÖÂÆπ</h5>
                            <div id="changes-list" style="font-size: 0.875rem;">
                                <!-- JavaScript„ÅßÂãïÁöÑ„Å´Êõ¥Êñ∞ -->
                            </div>
                        </div>

                        <!-- ÈÅ∏Êäû„Åó„Åü„É¢„É≥„Çπ„Çø„Éº„Éó„É¨„Éì„É•„Éº -->
                        <div id="monster-preview" style="margin-top: 1rem; padding: 1.5rem; background: #f9fafb; border-radius: 8px;">
                            <h5 style="margin-bottom: 1rem; color: var(--admin-primary);">ÈÅ∏Êäû‰∏≠„ÅÆ„É¢„É≥„Çπ„Çø„Éº</h5>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div id="monster-emoji" style="font-size: 3rem;">üëπ</div>
                                <div>
                                    <div id="monster-name" style="font-weight: bold; font-size: 1.1rem;"></div>
                                    <div id="monster-level" style="color: var(--admin-secondary); font-size: 0.875rem;"></div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-size: 0.875rem;">
                                <div><strong>HP:</strong> <span id="monster-hp"></span></div>
                                <div><strong>ÊîªÊíÉ:</strong> <span id="monster-attack"></span></div>
                                <div><strong>Èò≤Âæ°:</strong> <span id="monster-defense"></span></div>
                                <div><strong>ÁµåÈ®ìÂÄ§:</strong> <span id="monster-exp"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈÄÅ‰ø°„Éú„Çø„É≥ -->
                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                    <a href="{{ route('admin.monster-spawns.show', $spawn->location_id) }}" class="admin-btn admin-btn-secondary">
                        „Ç≠„É£„É≥„Çª„É´
                    </a>
                    <button type="submit" class="admin-btn admin-btn-warning">
                        üíæ Â§âÊõ¥„Çí‰øùÂ≠ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Âç±Èô∫„Å™Êìç‰Ωú -->
    @if(auth()->user()->can('monsters.delete'))
    <div class="admin-card" style="border-left: 4px solid var(--admin-danger);">
        <div class="admin-card-header" style="background-color: #fef2f2;">
            <h3 class="admin-card-title" style="color: var(--admin-danger);">üóëÔ∏è Âç±Èô∫„Å™Êìç‰Ωú</h3>
        </div>
        <div class="admin-card-body">
            <p style="color: var(--admin-danger); margin-bottom: 1rem;">
                „Åì„ÅÆ„Çπ„Éù„Éº„É≥Ë®≠ÂÆö„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ
            </p>
            <form method="POST" action="{{ route('admin.monster-spawns.destroy', $spawn->id) }}" 
                  style="display: inline;" 
                  onsubmit="return confirm('„Åì„ÅÆ„Çπ„Éù„Éº„É≥Ë®≠ÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n\n„É¢„É≥„Çπ„Çø„Éº: {{ $spawn->monster->name }}\nÂá∫ÁèæÁéá: {{ round($spawn->spawn_rate * 100, 1) }}%\n\n‚Äª„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ')">
                @csrf
                @method('DELETE')
                <button type="submit" class="admin-btn admin-btn-danger">
                    üóëÔ∏è „Åì„ÅÆ„Çπ„Éù„Éº„É≥„ÇíÂâäÈô§
                </button>
            </form>
        </div>
    </div>
    @endif
</div>

<script>
// „Ç™„É™„Ç∏„Éä„É´„ÅÆË®≠ÂÆöÂÄ§„Çí‰øùÂ≠ò
const originalSettings = {
    monster_id: '{{ $spawn->monster_id }}',
    spawn_rate: {{ $spawn->spawn_rate }},
    priority: {{ $spawn->priority }},
    min_level: {{ $spawn->min_level ?? 'null' }},
    max_level: {{ $spawn->max_level ?? 'null' }},
    is_active: {{ $spawn->is_active ? 'true' : 'false' }}
};

// Âá∫ÁèæÁéáË°®Á§∫„ÅÆÊõ¥Êñ∞
function updateRateDisplay(rate) {
    const percentage = Math.round(parseFloat(rate || 0) * 100 * 10) / 10;
    document.getElementById('rate-percentage').textContent = percentage + '%';
    updateChangePreview();
}

// „É¢„É≥„Çπ„Çø„Éº„Éó„É¨„Éì„É•„Éº„ÅÆÊõ¥Êñ∞
function updateMonsterPreview(monsterId) {
    const select = document.querySelector('select[name="monster_id"]');
    const option = select.querySelector(`option[value="${monsterId}"]`);
    
    if (option && monsterId) {
        document.getElementById('monster-emoji').textContent = option.dataset.emoji || 'üëπ';
        document.getElementById('monster-name').textContent = option.textContent.replace(/^[^\s]+\s/, '');
        document.getElementById('monster-level').textContent = `Level ${option.dataset.level}`;
        document.getElementById('monster-hp').textContent = parseInt(option.dataset.hp).toLocaleString();
        document.getElementById('monster-attack').textContent = parseInt(option.dataset.attack).toLocaleString();
        document.getElementById('monster-defense').textContent = parseInt(option.dataset.defense).toLocaleString();
        document.getElementById('monster-exp').textContent = parseInt(option.dataset.exp).toLocaleString();
    }
    updateChangePreview();
}

// Â§âÊõ¥„Éó„É¨„Éì„É•„Éº„ÅÆÊõ¥Êñ∞
function updateChangePreview() {
    const form = document.getElementById('spawn-edit-form');
    const changes = [];
    
    // „É¢„É≥„Çπ„Çø„ÉºÂ§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
    const currentMonsterId = form.querySelector('select[name="monster_id"]').value;
    if (currentMonsterId !== originalSettings.monster_id) {
        const option = form.querySelector(`option[value="${currentMonsterId}"]`);
        changes.push(`„É¢„É≥„Çπ„Çø„Éº ‚Üí ${option.textContent}`);
    }
    
    // Âá∫ÁèæÁéáÂ§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
    const currentRate = parseFloat(form.querySelector('input[name="spawn_rate"]').value);
    if (Math.abs(currentRate - originalSettings.spawn_rate) > 0.0001) {
        changes.push(`Âá∫ÁèæÁéá ‚Üí ${Math.round(currentRate * 100 * 10) / 10}%`);
    }
    
    // ÂÑ™ÂÖàÂ∫¶Â§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
    const currentPriority = parseInt(form.querySelector('input[name="priority"]').value);
    if (currentPriority !== originalSettings.priority) {
        changes.push(`ÂÑ™ÂÖàÂ∫¶ ‚Üí ${currentPriority}`);
    }
    
    // „É¨„Éô„É´Âà∂ÈôêÂ§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
    const currentMinLevel = form.querySelector('input[name="min_level"]').value;
    const currentMaxLevel = form.querySelector('input[name="max_level"]').value;
    const minChanged = (currentMinLevel || null) != originalSettings.min_level;
    const maxChanged = (currentMaxLevel || null) != originalSettings.max_level;
    
    if (minChanged || maxChanged) {
        let levelText = '„É¨„Éô„É´Âà∂Èôê ‚Üí ';
        if (currentMinLevel && currentMaxLevel) {
            levelText += `Lv.${currentMinLevel}-${currentMaxLevel}`;
        } else if (currentMinLevel) {
            levelText += `Lv.${currentMinLevel}‰ª•‰∏ä`;
        } else if (currentMaxLevel) {
            levelText += `Lv.${currentMaxLevel}‰ª•‰∏ã`;
        } else {
            levelText += 'Âà∂Èôê„Å™„Åó';
        }
        changes.push(levelText);
    }
    
    // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÉÅ„Çß„ÉÉ„ÇØ
    const currentActive = form.querySelector('input[name="is_active"]').checked;
    if (currentActive !== originalSettings.is_active) {
        changes.push(`„Çπ„ÉÜ„Éº„Çø„Çπ ‚Üí ${currentActive ? 'ÊúâÂäπ' : 'ÁÑ°Âäπ'}`);
    }
    
    // Â§âÊõ¥„É™„Çπ„Éà„ÅÆË°®Á§∫
    const changesList = document.getElementById('changes-list');
    if (changes.length > 0) {
        changesList.innerHTML = changes.map(change => `‚Ä¢ ${change}`).join('<br>');
        document.getElementById('change-preview').style.display = 'block';
    } else {
        changesList.innerHTML = 'Â§âÊõ¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì';
    }
}

// „Éï„Ç©„Éº„É†ÈÄÅ‰ø°ÊôÇ„ÅÆÁ¢∫Ë™ç
document.getElementById('spawn-edit-form').addEventListener('submit', function(e) {
    const confirmation = confirm('„Çπ„Éù„Éº„É≥Ë®≠ÂÆö„ÇíÂ§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü');
    if (!confirmation) {
        e.preventDefault();
    }
});

// „Éï„Ç©„Éº„É†„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('spawn-edit-form');
    const inputs = form.querySelectorAll('input, select');
    
    // ÂàùÊúü„Éó„É¨„Éì„É•„Éº„ÇíË°®Á§∫
    updateMonsterPreview(form.querySelector('select[name="monster_id"]').value);
    updateChangePreview();
    
    // Â§âÊõ¥Áõ£Ë¶ñ
    inputs.forEach(input => {
        input.addEventListener('change', updateChangePreview);
        input.addEventListener('input', updateChangePreview);
    });
});
</script>

<style>
/* ÁÆ°ÁêÜÁîªÈù¢Âõ∫Êúâ„ÅÆ„Çπ„Çø„Ç§„É´ */
.admin-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
}

.admin-badge-primary { background-color: #dbeafe; color: #1d4ed8; }
.admin-badge-secondary { background-color: #f1f5f9; color: #475569; }
.admin-badge-success { background-color: #dcfce7; color: #166534; }
.admin-badge-warning { background-color: #fef3c7; color: #d97706; }
.admin-badge-danger { background-color: #fee2e2; color: #dc2626; }
.admin-badge-info { background-color: #e0f2fe; color: #0369a1; }
</style>
@endsection