@extends('admin.layouts.app')

@section('title', '„Ç¢„Ç§„ÉÜ„É†Á∑®ÈõÜ')
@section('subtitle', $item->name . ' „ÅÆÁ∑®ÈõÜ')

@section('content')
<div class="admin-content-container">
    
    <form method="POST" action="{{ route('admin.items.update', $item->id) }}" id="item-edit-form">
        @csrf
        @method('PUT')
        
        <!-- Âü∫Êú¨ÊÉÖÂ†± -->
        <div class="admin-card" style="margin-bottom: 2rem;">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Âü∫Êú¨ÊÉÖÂ†±</h3>
            </div>
            <div class="admin-card-body">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem;">
                    <div>
                        <!-- „Ç¢„Ç§„ÉÜ„É†ID -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="item_id" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Ç¢„Ç§„ÉÜ„É†ID <span style="color: #dc2626;">*</span>
                                @if(isset($item->is_standard) && $item->is_standard)
                                    <small style="color: var(--admin-warning);">(Ê®ôÊ∫ñ„Ç¢„Ç§„ÉÜ„É†Áî®: std_1, std_2„Å™„Å©)</small>
                                @endif
                            </label>
                            <input type="text" id="item_id" name="item_id" value="{{ old('item_id', $item->id) }}" 
                                   class="admin-input @error('item_id') admin-input-error @enderror" 
                                   required pattern="[a-zA-Z][a-zA-Z0-9_-]*"
                                   placeholder="‰æã: std_1, custom_sword_1">
                            @error('item_id')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- „Ç¢„Ç§„ÉÜ„É†Âêç -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="name" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Ç¢„Ç§„ÉÜ„É†Âêç <span style="color: #dc2626;">*</span>
                            </label>
                            <input type="text" id="name" name="name" value="{{ old('name', $item->name) }}" 
                                   class="admin-input @error('name') admin-input-error @enderror" required>
                            @error('name')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- Ë™¨Êòé -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="description" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                Ë™¨Êòé
                            </label>
                            <textarea id="description" name="description" rows="3" 
                                      class="admin-input @error('description') admin-input-error @enderror" 
                                      placeholder="„Ç¢„Ç§„ÉÜ„É†„ÅÆË™¨Êòé„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...">{{ old('description', $item->description) }}</textarea>
                            @error('description')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- „Ç´„ÉÜ„Ç¥„É™ -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="category" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Ç´„ÉÜ„Ç¥„É™ <span style="color: #dc2626;">*</span>
                            </label>
                            <select id="category" name="category" 
                                    class="admin-select @error('category') admin-input-error @enderror" required
                                    onchange="updateCategorySettings()">
                                <option value="">„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû...</option>
                                @foreach($categories as $key => $name)
                                <option value="{{ $key }}" {{ old('category', $item->category) === $key ? 'selected' : '' }}>
                                    {{ $name }}
                                </option>
                                @endforeach
                            </select>
                            @error('category')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- „Ç´„ÉÜ„Ç¥„É™ÂêçÔºàÊ®ôÊ∫ñ„Ç¢„Ç§„ÉÜ„É†Áî®Ôºâ -->
                        @if(isset($item->is_standard) && $item->is_standard)
                        <div style="margin-bottom: 1.5rem;">
                            <label for="category_name" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Ç´„ÉÜ„Ç¥„É™Âêç <span style="color: #dc2626;">*</span>
                            </label>
                            <input type="text" id="category_name" name="category_name" value="{{ old('category_name', $item->category_name) }}" 
                                   class="admin-input @error('category_name') admin-input-error @enderror" required>
                            @error('category_name')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ÁµµÊñáÂ≠óÔºàÊ®ôÊ∫ñ„Ç¢„Ç§„ÉÜ„É†Áî®Ôºâ -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="emoji" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                ÁµµÊñáÂ≠ó
                            </label>
                            <input type="text" id="emoji" name="emoji" value="{{ old('emoji', $item->emoji ?? 'üì¶') }}" 
                                   class="admin-input @error('emoji') admin-input-error @enderror" 
                                   style="width: 80px; text-align: center; font-size: 1.5rem;" maxlength="4">
                            @error('emoji')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>
                        @endif
                    </div>

                    <div>
                        <!-- ‰æ°Ê†º -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="value" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                ‰æ°Ê†º <span style="color: #dc2626;">*</span>
                            </label>
                            <div style="position: relative;">
                                <input type="number" id="value" name="value" value="{{ old('value', $item->value) }}" 
                                       class="admin-input @error('value') admin-input-error @enderror" 
                                       min="0" max="999999" required>
                                <span style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--admin-secondary);">G</span>
                            </div>
                            @error('value')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- Â£≤Âç¥‰æ°Ê†º -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="sell_price" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                @if(isset($item->is_standard) && $item->is_standard)
                                    Â£≤Âç¥‰æ°Ê†º <small style="color: var(--admin-secondary);">(Ê®ôÊ∫ñ„Ç¢„Ç§„ÉÜ„É†„ÅØÁõ¥Êé•Ë®≠ÂÆö)</small>
                                @else
                                    Â£≤Âç¥‰æ°Ê†º <small style="color: var(--admin-secondary);">(Á©∫„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÁÆóÂá∫: {{ number_format($item->getSellPrice()) }}G)</small>
                                @endif
                            </label>
                            <div style="position: relative;">
                                <input type="number" id="sell_price" name="sell_price" value="{{ old('sell_price', $item->sell_price) }}" 
                                       class="admin-input @error('sell_price') admin-input-error @enderror" 
                                       min="0" max="999999">
                                <span style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--admin-secondary);">G</span>
                            </div>
                            @error('sell_price')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- „Çπ„Çø„ÉÉ„ÇØÂà∂Èôê -->
                        <div style="margin-bottom: 1.5rem;" id="stack-limit-field">
                            <label for="stack_limit" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Çπ„Çø„ÉÉ„ÇØÂà∂Èôê
                            </label>
                            <input type="number" id="stack_limit" name="stack_limit" value="{{ old('stack_limit', $item->stack_limit) }}" 
                                   class="admin-input @error('stack_limit') admin-input-error @enderror" 
                                   min="1" max="999" placeholder="‰æã: 50">
                            @error('stack_limit')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ÊúÄÂ§ßËÄê‰πÖÂ∫¶ -->
                        <div style="margin-bottom: 1.5rem;" id="durability-field">
                            <label for="max_durability" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                ÊúÄÂ§ßËÄê‰πÖÂ∫¶
                            </label>
                            <input type="number" id="max_durability" name="max_durability" value="{{ old('max_durability', $item->max_durability) }}" 
                                   class="admin-input @error('max_durability') admin-input-error @enderror" 
                                   min="1" max="9999" placeholder="‰æã: 100">
                            @error('max_durability')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ‰ΩúÊàêÊó•„ÉªÊõ¥Êñ∞Êó• -->
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">‰ΩúÊàê„ÉªÊõ¥Êñ∞ÊÉÖÂ†±</label>
                            <div style="padding: 0.75rem; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">
                                <div>‰ΩúÊàêÊó•: 
                                    @if(isset($item->is_standard) && $item->is_standard)
                                        {{ $item->created_at }}
                                    @else
                                        {{ $item->created_at->format('Y/m/d H:i') }}
                                    @endif
                                </div>
                                @if($item->updated_at != $item->created_at)
                                <div style="margin-top: 0.25rem;">Êõ¥Êñ∞Êó•: 
                                    @if(isset($item->is_standard) && $item->is_standard)
                                        {{ $item->updated_at }}
                                    @else
                                        {{ $item->updated_at->format('Y/m/d H:i') }}
                                    @endif
                                </div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê≠¶Âô®Ë®≠ÂÆö -->
        <div class="admin-card" id="weapon-settings" style="margin-bottom: 2rem;">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Ê≠¶Âô®Ë®≠ÂÆö</h3>
            </div>
            <div class="admin-card-body">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem;">
                    <div>
                        <!-- Ê≠¶Âô®„Çø„Ç§„Éó -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="weapon_type" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                Ê≠¶Âô®„Çø„Ç§„Éó
                            </label>
                            <select id="weapon_type" name="weapon_type" class="admin-select">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                @foreach($weaponTypes as $value => $label)
                                <option value="{{ $value }}" {{ old('weapon_type', $item->weapon_type) === $value ? 'selected' : '' }}>
                                    {{ $label }}
                                </option>
                                @endforeach
                            </select>
                        </div>
                    </div>

                    <div>
                        <!-- „Éê„Éà„É´„Çπ„Ç≠„É´ -->
                        <div style="margin-bottom: 1.5rem;">
                            <label for="battle_skill_id" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Éê„Éà„É´„Çπ„Ç≠„É´ID <small style="color: var(--admin-secondary);">(„Ç™„Éó„Ç∑„Éß„É≥)</small>
                            </label>
                            <input type="text" id="battle_skill_id" name="battle_skill_id" value="{{ old('battle_skill_id', $item->battle_skill_id) }}" 
                                   class="admin-input @error('battle_skill_id') admin-input-error @enderror" 
                                   placeholder="‰æã: fire_magic, ice_magic">
                            @error('battle_skill_id')
                                <div class="admin-error-message">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- Ê®ôÊ∫ñ„Ç¢„Ç§„ÉÜ„É†Áî®„Éï„Ç£„Éº„É´„Éâ -->
                        @if(isset($item->is_standard) && $item->is_standard)
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                „Ç¢„Ç§„ÉÜ„É†Ë®≠ÂÆö
                            </label>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="hidden" name="is_equippable" value="0">
                                    <input type="checkbox" name="is_equippable" value="1" 
                                           {{ old('is_equippable', $item->is_equippable ?? false) ? 'checked' : '' }}
                                           style="margin-right: 0.5rem;">
                                    Ë£ÖÂÇôÂèØËÉΩ
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="hidden" name="is_usable" value="0">
                                    <input type="checkbox" name="is_usable" value="1" 
                                           {{ old('is_usable', $item->is_usable ?? false) ? 'checked' : '' }}
                                           style="margin-right: 0.5rem;">
                                    ‰ΩøÁî®ÂèØËÉΩ
                                </label>
                            </div>
                        </div>
                        @endif
                    </div>
                </div>
            </div>
        </div>

        <!-- „Ç®„Éï„Çß„ÇØ„ÉàË®≠ÂÆö -->
        <div class="admin-card" style="margin-bottom: 2rem;">
            <div class="admin-card-header">
                <h3 class="admin-card-title">„Ç®„Éï„Çß„ÇØ„ÉàË®≠ÂÆö</h3>
                <div style="font-size: 0.875rem; color: var(--admin-secondary);">
                    0‰ª•Â§ñ„ÅÆÂÄ§„ÇíÂÖ•Âäõ„Åó„Åü„Ç®„Éï„Çß„ÇØ„Éà„ÅÆ„Åø„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô
                </div>
            </div>
            <div class="admin-card-body">
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÁ≥ª -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #374151;">„Çπ„ÉÜ„Éº„Çø„ÇπÁ≥ª</h4>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_attack" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">ÊîªÊíÉÂäõ</label>
                            <input type="number" id="effect_attack" name="effect_attack" value="{{ old('effect_attack', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['attack'] ?? 0) : $item->getEffectValue('attack')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_defense" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Èò≤Âæ°Âäõ</label>
                            <input type="number" id="effect_defense" name="effect_defense" value="{{ old('effect_defense', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['defense'] ?? 0) : $item->getEffectValue('defense')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_agility" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">ÊïèÊç∑ÊÄß</label>
                            <input type="number" id="effect_agility" name="effect_agility" value="{{ old('effect_agility', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['agility'] ?? 0) : $item->getEffectValue('agility')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                    </div>

                    <!-- Êà¶ÈóòÁ≥ª -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #374151;">Êà¶ÈóòÁ≥ª</h4>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_magic_attack" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">È≠îÊ≥ïÊîªÊíÉÂäõ</label>
                            <input type="number" id="effect_magic_attack" name="effect_magic_attack" value="{{ old('effect_magic_attack', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['magic_attack'] ?? 0) : $item->getEffectValue('magic_attack')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_accuracy" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">ÂëΩ‰∏≠Áéá</label>
                            <input type="number" id="effect_accuracy" name="effect_accuracy" value="{{ old('effect_accuracy', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['accuracy'] ?? 0) : $item->getEffectValue('accuracy')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_evasion" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">ÂõûÈÅøÁéá</label>
                            <input type="number" id="effect_evasion" name="effect_evasion" value="{{ old('effect_evasion', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['evasion'] ?? 0) : $item->getEffectValue('evasion')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                    </div>

                    <!-- ÂõûÂæ©„Éª„Åù„ÅÆ‰ªñ -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #374151;">ÂõûÂæ©„Éª„Åù„ÅÆ‰ªñ</h4>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_heal_hp" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">HPÂõûÂæ©</label>
                            <input type="number" id="effect_heal_hp" name="effect_heal_hp" value="{{ old('effect_heal_hp', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['heal_hp'] ?? 0) : $item->getEffectValue('heal_hp')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_heal_mp" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">MPÂõûÂæ©</label>
                            <input type="number" id="effect_heal_mp" name="effect_heal_mp" value="{{ old('effect_heal_mp', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['heal_mp'] ?? 0) : $item->getEffectValue('heal_mp')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="effect_inventory_slots" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">„Ç§„É≥„Éô„É≥„Éà„É™Êã°Âºµ</label>
                            <input type="number" id="effect_inventory_slots" name="effect_inventory_slots" value="{{ old('effect_inventory_slots', (isset($item->is_standard) && $item->is_standard) ? ($item->effects['inventory_slots'] ?? 0) : $item->getEffectValue('inventory_slots')) }}" 
                                   class="admin-input" placeholder="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Êìç‰Ωú„Éú„Çø„É≥ -->
        <div style="display: flex; gap: 1rem; justify-content: end;">
            <a href="{{ route('admin.items.show', $item->id) }}" class="admin-btn admin-btn-secondary">
                ‚Üê Ë©≥Á¥∞„Å´Êàª„Çã
            </a>
            <button type="button" onclick="resetForm()" class="admin-btn admin-btn-secondary">
                üîÑ „É™„Çª„ÉÉ„Éà
            </button>
            <button type="button" onclick="previewItem()" class="admin-btn admin-btn-info">
                üëÅÔ∏è „Éó„É¨„Éì„É•„Éº
            </button>
            <button type="submit" class="admin-btn admin-btn-primary">
                üíæ Êõ¥Êñ∞
            </button>
        </div>
    </form>
</div>

<!-- „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´ -->
<div id="preview-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 2rem; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
        <h3 style="margin-bottom: 1.5rem;">„Ç¢„Ç§„ÉÜ„É†„Éó„É¨„Éì„É•„Éº</h3>
        <div id="preview-content">
            <!-- JavaScript„ÅßÂãïÁöÑ„Å´Êõ¥Êñ∞ -->
        </div>
        <div style="display: flex; gap: 1rem; justify-content: end; margin-top: 2rem;">
            <button type="button" onclick="hidePreview()" class="admin-btn admin-btn-secondary">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>
</div>

<script>
// „Ç´„ÉÜ„Ç¥„É™Â§âÊõ¥ÊôÇ„ÅÆË®≠ÂÆöÊõ¥Êñ∞
function updateCategorySettings() {
    const category = document.getElementById('category').value;
    const weaponSettings = document.getElementById('weapon-settings');
    const stackLimitField = document.getElementById('stack-limit-field');
    const durabilityField = document.getElementById('durability-field');
    
    // Ê≠¶Âô®Ë®≠ÂÆö„ÅÆË°®Á§∫Âà∂Âæ°
    if (category === 'weapon') {
        weaponSettings.style.display = 'block';
    } else {
        weaponSettings.style.display = 'none';
    }
}

// „Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
function resetForm() {
    if (confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºüÊú™‰øùÂ≠ò„ÅÆÂ§âÊõ¥„ÅØÂ§±„Çè„Çå„Åæ„Åô„ÄÇ')) {
        document.getElementById('item-edit-form').reset();
        
        // „Ç™„É™„Ç∏„Éä„É´„ÅÆÂÄ§„Å´Êàª„Åô
        document.getElementById('name').value = '{{ $item->name }}';
        document.getElementById('description').value = '{{ $item->description }}';
        document.getElementById('category').value = '{{ $item->category->value ?? $item->category }}';
        document.getElementById('value').value = '{{ $item->value }}';
        document.getElementById('sell_price').value = '{{ $item->sell_price }}';
        document.getElementById('stack_limit').value = '{{ $item->stack_limit }}';
        document.getElementById('max_durability').value = '{{ $item->max_durability }}';
        document.getElementById('weapon_type').value = '{{ $item->weapon_type }}';
        document.getElementById('battle_skill_id').value = '{{ $item->battle_skill_id }}';
        
        // „Ç®„Éï„Çß„ÇØ„Éà„ÅÆ„É™„Çª„ÉÉ„Éà
        @foreach(['attack', 'defense', 'agility', 'magic_attack', 'accuracy', 'evasion', 'heal_hp', 'heal_mp', 'inventory_slots'] as $effect)
        document.getElementById('effect_{{ $effect }}').value = '{{ (isset($item->is_standard) && $item->is_standard) ? ($item->effects[$effect] ?? 0) : $item->getEffectValue($effect) }}';
        @endforeach
        
        updateCategorySettings();
    }
}

// „Ç¢„Ç§„ÉÜ„É†„Éó„É¨„Éì„É•„ÉºÔºàcreate.blade.php„Å®Âêå„ÅòÈñ¢Êï∞Ôºâ
function previewItem() {
    const formData = new FormData(document.getElementById('item-edit-form'));
    
    let previewHTML = '<div class="item-preview" style="border: 2px solid var(--admin-primary); border-radius: 8px; padding: 1.5rem;">';
    previewHTML += '<div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">';
    previewHTML += '<div style="width: 50px; height: 50px; border-radius: 8px; background: var(--admin-primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">üì¶</div>';
    previewHTML += '<div>';
    previewHTML += '<h4 style="margin: 0; font-size: 1.25rem;">' + (formData.get('name') || 'Êú™Ë®≠ÂÆö') + '</h4>';
    previewHTML += '<p style="margin: 0.25rem 0 0 0; color: var(--admin-secondary);">' + (formData.get('description') || 'Ë™¨Êòé„Å™„Åó') + '</p>';
    previewHTML += '</div>';
    previewHTML += '</div>';
    
    // Âü∫Êú¨ÊÉÖÂ†±
    previewHTML += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">';
    previewHTML += '<div><strong>„Ç´„ÉÜ„Ç¥„É™:</strong> ' + (formData.get('category') || 'Êú™Ë®≠ÂÆö') + '</div>';
    previewHTML += '<div><strong>‰æ°Ê†º:</strong> ' + (formData.get('value') ? Number(formData.get('value')).toLocaleString() + 'G' : '0G') + '</div>';
    
    if (formData.get('stack_limit')) {
        previewHTML += '<div><strong>„Çπ„Çø„ÉÉ„ÇØÂà∂Èôê:</strong> ' + formData.get('stack_limit') + 'ÂÄã</div>';
    }
    if (formData.get('max_durability')) {
        previewHTML += '<div><strong>ÊúÄÂ§ßËÄê‰πÖÂ∫¶:</strong> ' + formData.get('max_durability') + '</div>';
    }
    previewHTML += '</div>';
    
    // „Ç®„Éï„Çß„ÇØ„Éà
    const effects = [];
    const effectFields = ['attack', 'defense', 'agility', 'magic_attack', 'accuracy', 'evasion', 'heal_hp', 'heal_mp', 'inventory_slots'];
    const effectNames = {
        'attack': 'ÊîªÊíÉÂäõ',
        'defense': 'Èò≤Âæ°Âäõ', 
        'agility': 'ÊïèÊç∑ÊÄß',
        'magic_attack': 'È≠îÊ≥ïÊîªÊíÉÂäõ',
        'accuracy': 'ÂëΩ‰∏≠Áéá',
        'evasion': 'ÂõûÈÅøÁéá',
        'heal_hp': 'HPÂõûÂæ©',
        'heal_mp': 'MPÂõûÂæ©',
        'inventory_slots': '„Ç§„É≥„Éô„É≥„Éà„É™Êã°Âºµ'
    };
    
    effectFields.forEach(field => {
        const value = formData.get('effect_' + field);
        if (value && Number(value) !== 0) {
            effects.push(effectNames[field] + ': +' + value);
        }
    });
    
    if (effects.length > 0) {
        previewHTML += '<div style="margin-top: 1rem;"><strong>„Ç®„Éï„Çß„ÇØ„Éà:</strong></div>';
        previewHTML += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 0.5rem;">';
        effects.forEach(effect => {
            previewHTML += '<div style="padding: 0.5rem; background: #f0f9ff; border-radius: 4px; font-size: 0.875rem;">' + effect + '</div>';
        });
        previewHTML += '</div>';
    }
    
    previewHTML += '</div>';
    
    document.getElementById('preview-content').innerHTML = previewHTML;
    document.getElementById('preview-modal').style.display = 'block';
}

function hidePreview() {
    document.getElementById('preview-modal').style.display = 'none';
}

// „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
document.getElementById('preview-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        hidePreview();
    }
});

// „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
document.addEventListener('DOMContentLoaded', function() {
    updateCategorySettings();
});

// „Éï„Ç©„Éº„É†ÈÄÅ‰ø°ÊôÇ„ÅÆÁ¢∫Ë™ç
document.getElementById('item-edit-form').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value;
    const category = document.getElementById('category').value;
    
    if (!name || !category) {
        alert('„Ç¢„Ç§„ÉÜ„É†Âêç„Å®„Ç´„ÉÜ„Ç¥„É™„ÅØÂøÖÈ†àÈ†ÖÁõÆ„Åß„Åô„ÄÇ');
        e.preventDefault();
        return false;
    }
    
    if (!confirm('„Åì„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅÆÂ§âÊõ¥„Çí‰øùÂ≠ò„Åó„Åæ„Åô„ÅãÔºü')) {
        e.preventDefault();
        return false;
    }
});

// Â£≤Âç¥‰æ°Ê†º„ÅÆËá™ÂãïË®àÁÆóË°®Á§∫Êõ¥Êñ∞
document.getElementById('value').addEventListener('input', function() {
    const value = this.value;
    const sellPriceField = document.getElementById('sell_price');
    const label = sellPriceField.previousElementSibling;
    if (value) {
        const autoPrice = Math.floor(value * 0.5);
        label.innerHTML = 'Â£≤Âç¥‰æ°Ê†º <small style="color: var(--admin-secondary);">(Á©∫„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÁÆóÂá∫: ' + autoPrice.toLocaleString() + 'G)</small>';
    }
});
</script>

<style>
.admin-input-error {
    border-color: #dc2626;
}

.admin-error-message {
    color: #dc2626;
    font-size: 0.875rem;
    margin-top: 0.25rem;
}
</style>
@endsection